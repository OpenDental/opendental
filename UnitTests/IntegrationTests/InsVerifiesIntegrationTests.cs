using Microsoft.VisualStudio.TestTools.UnitTesting;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using OpenDentBusiness.Eclaims;
using UnitTestsCore;
using OpenDentBusiness;
using System.Reflection;
using OpenDental;

namespace UnitTests.IntegrationTests {
	[TestClass]
	public class InsVerifiesIntegrationTests {
		///<summary>This method will execute only once, just before any tests in this class run.</summary>
		[ClassInitialize]
		public static void SetupClass(TestContext testContext) {
		}

		///<summary>This method will execute just before each test in this class.</summary>
		[TestInitialize]
		public void SetupTest() {
			ClaimProcT.ClearClaimProcTable();
			ProcedureT.ClearProcedureTable();
		}

		[TestMethod]
		public void InsVerifies_Fake271ResponseSimple_ShouldPassValidation() {
			AppointmentT.ClearAppointmentTable();
			CarrierT.ClearCarrierTable();
			string suffix=MethodBase.GetCurrentMethod().Name;
			x270Controller.FakeResponseOverride271="ISA*00*          *00*          *30*330989922      *29*AA0989922      *030606*0936*U*00401*000013966*0*T*:~GS*HB*330989922*AA0989922*20030606*0936*13966*X*004010X092~ST*271*0001~BHT*0022*11*ASX012145WEB*20030606*0936~HL*1**20*1~NM1*PR*2*ACMEINC*****PI*12345~HL*2*1*21*1~NM1*1P*1*PROVLAST*PROVFIRST****SV*5558006~HL*3*2*22*0~TRN*2*100*1330989922~NM1*IL*1*SMITH*JOHN*B***MI*123456789~REF*6P*XYZ123*GROUPNAME~REF*18*2484568*TEST PLAN NAME~N3*29 FREMONT ST*~N4*PEACE*NY*10023~DMG*D8*19570515*M~DTP*307*RD8*19910712-19920525~EB*1*FAM*30~SE*17*0001~GE*1*13966~IEA*1*000013966~";
			long provNum=ProviderT.CreateProvider("prov1","terry","smith",ssn:"123456789",isUsingTIN:true,nationalProvID:"0123456789");
			Prefs.UpdateLong(PrefName.PracticeDefaultProv,provNum);
			Patient pat=PatientT.CreatePatient(suffix,priProvNum:provNum,birthDate:DateTime.Today);
			//Create clearinghouse, set required fields for benefit request validation, and set as default.
			Clearinghouse ch=ClearinghouseT.CreateClearinghouse("ClaimConnect",commBridge:EclaimsCommBridge.ClaimConnect,eFormat:ElectronicClaimFormat.x837D_5010_dental,isa05:"ZZ",
				isa07:"30",isa08:"BCBSGA",isa15:"P");
			Prefs.UpdateLong(PrefName.ClearinghouseDefaultEligibility,ch.ClearinghouseNum);
			Prefs.RefreshCache();
			Clearinghouses.Insert(ch);
			//Create carrier and set required fields for benefit request validation
			Carrier carrier=CarrierT.CreateCarrier(suffix,"123 boring st","boring","OR","97306","1234",arrayTrustedEtrans:TrustedEtransTypes.RealTimeEligibility);
			Carriers.RefreshCache();
			InsPlan insPlan=InsPlanT.CreateInsPlan(carrier.CarrierNum,groupNum:"XYZ123");//Group number should be >3 characters so it passes insverify validation
			InsSub insSub=InsSubT.CreateInsSub(pat.PatNum,insPlan.PlanNum);
			PatPlan patPlan=PatPlanT.CreatePatPlan(1,pat.PatNum,insSub.InsSubNum);
			Operatory op=OperatoryT.CreateOperatory();
			AppointmentT.CreateAppointment(pat.PatNum,DateTime.Today,op.OperatoryNum,provNum);
			List<InsVerify> listInsVerifies=InsVerifies.TryBatchPatInsVerify();
			//Should only be one patient in the list and they should have passed validation.
			Assert.IsTrue(listInsVerifies.FirstOrDefault().BatchVerifyState==BatchInsVerifyState.Success);
		}

		[TestMethod]
		public void InsVerifies_Fake271ResponseGuardian_IndividualGeneralDeductibleMismatchAndFamilyGeneralDeductibleMismatch() {
			AppointmentT.ClearAppointmentTable();
			CarrierT.ClearCarrierTable();
			string suffix=MethodBase.GetCurrentMethod().Name;
			x270Controller.FakeResponseOverride271="ISA*00*          *00*          *30*330989922      *ZZ*810624427      *190313*1132*U*00401*342242985*0*P*:~GS*HB*330989922*330989922*20190313*1132*342242985*X*004010X092A1~ST*271*0001~BHT*7711*77*411111224FCH*17727474*7741~HL*7**17*7~NM1*LL*1*VLILUJIF WJWC JFULLIFEC EP. PW ITCL*****LJ*51115~HL*1*7*17*7~NM1*7L*1*LLPWCUUJPFIW UCFBIW IWWJIFEC WWE*****WJ*131412725~HL*4*1*11*7~TRN*1*7*7131412725~NM1*JW*7*FIWWIEC*ILWJI****TJ*215177124~REF*5L*77441274*FPLBI ITCLJEIF UCFBIW VLPLL~N3*474 C IPTC UBLCCB~N4*FCF EIUBWC*LI*75777~DMG*U2*72217371*W~DTP*445*U2*17737777~DTP*443*U2*17477147~EB*F~MSG*OPLL HCFCWJB LCLJPU JU WLPT IIFLILO 7 BP UCECTHCL 47~EB*F~MSG*FPF-EPFBLIEBCU EPSCLIVC JU HIUCU PF LCIUPFIHWC IFU ELUBPTILO~EB*1**35**GUARDIAN~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U*AD:D0431~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCLIJL~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCHIUC~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCWJFC~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC IUILUBTCFBU~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCWJFC/LCHIUC~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=WWLPLJUC~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U*AD:D4910~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=EPTLPUJBCU~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=JTLWIFBU~MSG*UCULEBJHWC FIJSCU~EB*A**7**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**30**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=HJBCFJFV D-LIOU~MSG*UCULEBJHWC FIJSCU~EB*A**36**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=CDITU~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=WLWW TPLBI/LIFPLCD~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=IILTWLW IIHJBU ILLWJIFEC~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=EPFULWBIBJPF~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U*AD:D9940~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**40**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=LLPLIOWIDJU~MSG*UCULEBJHWC FIJSCU~EB*A**39**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=ITIWVIT & EPTLPUJBC~MSG*UCULEBJHWC FIJSCU~EB*A**98**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCIWIFBU~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U*AD:D0391~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**24**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**38**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.50****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**38**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*******U~MSG*EPSCLCU PF CWJVJHWC UCLCFUCFB EIJWULCF FIP ILC WCUU BIIF 72~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***1.00****U~MSG*HCFCWJBEWIUU=BTI BLCIBTCFB~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UJIVFPUBJE D-LIO~MSG*UCULEBJHWC FIJSCU~EB*A**25**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**26**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=LCLJP ULLVCLO~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=JFWIO/PFWIO~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLCU~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=HLJWULLU/LPUB IFU EPLC~MSG*UCULEBJHWC FIJSCU~EB*A****DG PLUS, NON CONTRACTED***0.00****U*AD:D0431~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCLIJL~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCHIUC~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCWJFC~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC IUILUBTCFBU~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCWJFC/LCHIUC~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=WWLPLJUC~MSG*UCULEBJHWC FIJSCU~EB*A****DG PLUS, NON CONTRACTED***0.20****U*AD:D4910~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=EPTLPUJBCU~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=JTLWIFBU~MSG*UCULEBJHWC ILLWJCU~EB*A**7**DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A**30**DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=HJBCFJFV D-LIOU~MSG*UCULEBJHWC FIJSCU~EB*A**36**DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=CDITU~MSG*UCULEBJHWC FIJSCU~EB*A****DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=WLWW TPLBI/LIFPLCD~MSG*UCULEBJHWC FIJSCU~EB*A****DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=IILTWLW IIHJBU ILLWJIFEC~MSG*UCULEBJHWC FIJSCU~EB*A****DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=EPFULWBIBJPF~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.20****U*AD:D9940~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A**40**DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=LLPLIOWIDJU~MSG*UCULEBJHWC FIJSCU~EB*A**39**DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=ITIWVIT & EPTLPUJBC~MSG*UCULEBJHWC ILLWJCU~EB*A**98**DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCIWIFBU~MSG*UCULEBJHWC FIJSCU~EB*A****DG PLUS, NON CONTRACTED***0.00****U*AD:D0391~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**24**DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**38**DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**38**DG PLUS, NON CONTRACTED*******U~MSG*EPSCLCU PF CWJVJHWC UCLCFUCFB EIJWULCF FIP ILC WCUU BIIF 72~EB*A****DG PLUS, NON CONTRACTED***1.00****U~MSG*HCFCWJBEWIUU=BTI BLCIBTCFB~EB*A****DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UJIVFPUBJE D-LIO~MSG*UCULEBJHWC FIJSCU~EB*A**25**DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A**26**DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=LCLJP ULLVCLO~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=JFWIO/PFWIO~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLCU~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=HLJWULLU/LPUB IFU EPLC~MSG*UCULEBJHWC ILLWJCU~EB*C*IND*35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*22******U~EB*C*FAM*35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*22******U~EB*F*IND*35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*23*2000.00*****U~EB*F*IND*35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*29*2000.00*****U~EB*F*IND*38**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*32*1000.00*****U~EB*C*IND*35**DG PLUS, NON CONTRACTED*22*50.00*****U~EB*C*IND*35**DG PLUS, NON CONTRACTED*29*50.00*****U~EB*C*FAM*35**DG PLUS, NON CONTRACTED*22*150.00*****U~EB*C*FAM*35**DG PLUS, NON CONTRACTED*29*150.00*****U~EB*F*IND*35**DG PLUS, NON CONTRACTED*23*2000.00*****U~EB*F*IND*35**DG PLUS, NON CONTRACTED*29*2000.00*****U~EB*F*IND*38**DG PLUS, NON CONTRACTED*32*1000.00*****U~EB*1**35*GP*GUARDIAN~EB*F~MSG*TLWBJ-SJUJB LLPECULLCU ILC LIJU PF BIC LLCLILIBJPF UIBC.~EB*F~MSG*FICF BIC CDLCEBCU EPUB PW I LLPLPUCU EPLLUC PW BLCIBTCFB JU $477 PL TPLC, FC LCEPTTCFU BIIB I LLCUCBCLTJFIBJPF HC ULHTJBBCU BP BIC EWIJTU IUULCUU.~EB*F********S8*40***AD:D0431~HSD*VS*1***34*24~EB*F~MSG*HCFCWJBEWIUU=UCFBLLC LCLIJL~EB*F~MSG*HCFCWJBEWIUU=UCFBLLC LCHIUC~EB*F~MSG*HCFCWJBEWIUU=UCFBLLC LCWJFC~EB*F~MSG*HCFCWJBEWIUU=UCFBLLC IUILUBTCFBU~EB*F~MSG*HCFCWJBEWIUU=UCFBLLC LCWJFC/LCHIUC~EB*F~HSD*VS*1***34*6~DTP*471*U2*22227777~MSG*HCFCWJBEWIUU=WWLPLJUC~MSG*FP IVC WJTJB.~EB*F************AD:D4910~DTP*471*U2*22227777~EB*F**35~MSG*LLCSCFBJSC UCLSJECU ILC CDCTLB WLPT BIC LCVLWIL IFFLIW TIDJTLT.~MSG*BCCBI TLUB HC CDBLIEBCU FIJWC JFULLCU FJBI BIJU VLILUJIF LWIF BP HC EPFUJUCLCU WPL LLPUBICBJE EPSCLIVC~MSG*BTI IIU I UCLILIBC $577 JFUJSJULIW UCULEBJHWC LCL               WJWCBJTC.~EB*F~MSG*HCFCWJBEWIUU=EPTLPUJBCU~MSG*LWIF UPCU FPB WJTJB ULLWIECU PW EPTLPUJBC LCUBPLIBJPFU.~MSG*LPUBCLJPL LCUJFU ILC FPB EPSCLCU, IF IWBCLFIBC HCFCWJB PW IF ITIWVIT LCUBPLIBJPF FJWW HC EPFUJUCLCU~EB*F~MSG*HCFCWJBEWIUU=JTLWIFBU~MSG*EPSCLCU FICF BICLC JU I WJIHJWJBO.~EB*I************AD:D4381~EB*F**7~MSG*EPFUJUCLCU FJBI BILCC PL TPLC EPSCLCU UJTLWC CDBLIEBJPFU PL IFO EPSCLCU ULLVJEIW LLPECULLC~EB*F**30~HSD*VS*1***34*12~DTP*471*U2*17727713~MSG*HCFCWJBEWIUU=HJBCFJFV D-LIOU~MSG*WJTJBCU BP CJBICL 1 JTIVCU PL I UCB PW SCLBJEIW HJBCFJFVU.~EB*F**36~MSG*UJFVWC ELPFFU ILC EPFUJUCLCU I TIIPL UCLSJEC.~EB*F~HSD*VS*1***34*6~DTP*471*U2*17727713~MSG*HCFCWJBEWIUU=CDITU~EB*F~HSD*VS*1***34*60~DTP*471*U2*22227777~MSG*HCFCWJBEWIUU=WLWW TPLBI/LIFPLCD~MSG*WJTJBCU BP CJBICL I WLWW TPLBI UCLJCU PL PFC LIFPLITJE WJWT~EB*F********S7*14~MSG*HCFCWJBEWIUU=IILTWLW IIHJBU ILLWJIFEC~MSG*EPSCLCU PFWO FICF FCCUCU BP JFIJHJB BILTH ULEPJFV; JFJBJIW ILLWJIFEC PFWO.~EB*F~MSG*HCFCWJBEWIUU=EPFULWBIBJPF~MSG*EPFULWBIBJPF, CSIWLIBJPF PW UWJUCU (U7121, U7124) EPSCLCU LFUCL BIC TIIPL EIBCVPLO.~EB*F************AD:D9940~HSD*VS*1***32*1~MSG*FICF LCLWPLTCU FJBIJF 5 TPFBIU PW PUUCPLU ULLVCLO~EB*F**40~MSG*PLIW ULLVCLO EWIJTU WLPT FPF EPFBLIEBCU LLPSJUCLU UIPLWU WJLUB HC ULHTJBBCU BP BIC JFULLCU'U TIIPL TCUJEIW EILLJCL.~EB*F************AD:D4341~HSD*VS*1***34*24~DTP*471*U2*22227777~MSG*LCL KLIULIFB, FICF FCCUCU ULC BP VJFVJSIW TJVLIBJPF IFU HPFC WPUU.~EB*F~HSD*VS*1***34*6~DTP*471*U2*17727713~MSG*HCFCWJBEWIUU=LLPLIOWIDJU~MSG*CJBICL PFC LCVLWIL LLPLIOWIDJU PL I LCLJPUPFBIW TIJFBCFIFEC LLPECULLC~EB*F**39~HSD*VS*1***21*5~HSD*VS*1***21*5~HSD*VS*1***21*5~MSG*ILLWJCU BP ELPFFU, JFWIOU IFU PFWIOU; FICF BIC ILLWJIFEC EIFFPB HC LCLIJLCU.~MSG*ILLWJCU BP LPUB IFU EPLCU; FICF JB EIFFPB HC LCLIJLCU.~MSG*ILLWJCU BP LILBJIWU, UCFBLLCU IFU HLJUVCU; FICF BIC ILLWJIFEC EIFFPB HC LCLIJLCU.~EB*F********S7*18~HSD*VS*1***34*12~MSG*HCFCWJBEWIUU=ITIWVIT & EPTLPUJBC~EB*F**98******S7*15~HSD*VS*1***34*36~MSG*HCFCWJBEWIUU=UCIWIFBU~MSG*WJTJBCU BP LCLTIFCFB LFLCUBPLCU TPWIL BCCBI PFWO.~EB*F~MSG*HCFCWJBEWIUU=BTI BLCIBTCFB~MSG*BIC WPWWPFJFV WJUB PW UCLSJECU ILC BIC PFWO UCLSJECU EPSCLCU LFUCL BIC BTI EIBCVPLO U7417-U7411,U3217,U3247,U3237.~EB*F************AD:D0391~EB*F**24~EB*F************AD:D0340~SE*375*0001~GE*1*342242985~IEA*1*342242985~";
			long provNum=ProviderT.CreateProvider("prov1","terry","smith",ssn:"123456789",isUsingTIN:true,nationalProvID:"0123456789");
			Prefs.UpdateLong(PrefName.PracticeDefaultProv,provNum);
			Patient pat=PatientT.CreatePatient(suffix,priProvNum:provNum,birthDate:DateTime.Today);
			//Create clearinghouse, set required fields for benefit request validation, and set as default.
			Clearinghouse ch=ClearinghouseT.CreateClearinghouse("ClaimConnect",commBridge:EclaimsCommBridge.ClaimConnect,eFormat:ElectronicClaimFormat.x837D_5010_dental,isa05:"ZZ",
				isa07:"30",isa08:"BCBSGA",isa15:"P");
			Prefs.UpdateLong(PrefName.ClearinghouseDefaultEligibility,ch.ClearinghouseNum);
			Prefs.RefreshCache();
			Clearinghouses.Insert(ch);
			//Create carrier and set required fields for benefit request validation
			Carrier carrier=CarrierT.CreateCarrier(suffix,"123 boring st","boring","OR","97306","1234",arrayTrustedEtrans:TrustedEtransTypes.RealTimeEligibility);
			Carriers.RefreshCache();
			InsPlan insPlan=InsPlanT.CreateInsPlan(carrier.CarrierNum,groupNum:"XYZ123");//Group number should be >3 characters so it passes insverify validation
			InsSub insSub=InsSubT.CreateInsSub(pat.PatNum,insPlan.PlanNum);
			PatPlan patPlan=PatPlanT.CreatePatPlan(1,pat.PatNum,insSub.InsSubNum);
			Operatory op=OperatoryT.CreateOperatory();
			AppointmentT.CreateAppointment(pat.PatNum,DateTime.Today,op.OperatoryNum,provNum);
			BenefitT.CreateAnnualMax(insPlan.PlanNum,BenefitCoverageLevel.Individual,2000);
			BenefitT.CreateDeductibleGeneral(insPlan.PlanNum,BenefitCoverageLevel.Family,500);
			List<InsVerify> listInsVerifies=InsVerifies.TryBatchPatInsVerify();
			//Should not pass validation because the benefits in the 271 do not match the benefits in OD.
			Assert.IsTrue(listInsVerifies.FirstOrDefault().BatchVerifyState==BatchInsVerifyState.Error);
			//More specifically we should get "Individual general deductible mismatch." and "Family general deductible mismatch."
			string[] errorNotes=listInsVerifies.FirstOrDefault().Note.Split('\n');
			Assert.IsTrue(errorNotes[0].Contains("Individual general deductible mismatch."));
			Assert.IsTrue(errorNotes[1].Contains("Family general deductible mismatch."));
		}

		[TestMethod]
		public void InsVerifies_Fake271ResponseMetlife_ShouldPassAllValidation() {
			AppointmentT.ClearAppointmentTable();
			CarrierT.ClearCarrierTable();
			string suffix=MethodBase.GetCurrentMethod().Name;
			x270Controller.FakeResponseOverride271="ISA*00*          *00*          *30*330989922      *ZZ*810624427      *191212*1221*U*00401*400512059*0*P*:~GS*HB*330989922*330989922*20191212*1221*400512059*X*004010X092A1~ST*271*0001~BHT*7711*77*177471742FCH*17727171*7117~HL*7**17*7~NM1*LL*1*TCBWJWC*****LJ*54232~HL*1*7*17*7~NM1*7L*7*LLPWCUUJPFIW UCFBIW IWWJIFEC WWE*****DD*7317421115~HL*4*1*11*7~NM1*JW*7*EILLPWW*IPWWO****TJ*427217752~REF*5L*474224*EPFIVLI HLIFUU JFE.~N3*772 VLIEC UBLCCB~N4*HLOIF*PI*14475~DMG*U2*72217247*W~HL*1*4*14*7~TRN*1*7*7131412725~NM1*74*7*EILLPWW*VLIUO*U***TJ*427217752~N3*772 VLIEC UBLCCB~N4*HLOIF*PI*14475~DMG*U2*17727771*T~INS*F*72~DTP*442*U2*17727777~DTP*415*U2*17727777~EB*F*IND*24***29*1717.20~EB*C*FAM*24**MET*32*0.00~EB*C*FAM*24**MET*22*0.00~EB*C*IND*24**MET*32*0.00~EB*C*IND*24**MET*22*0.00~EB*C*FAM*24***32*0.00~EB*C*FAM*24***22*0.00~EB*C*IND*24***32*0.00~EB*C*IND*24***22*0.00~EB*F*IND*38***33*2000.00~EB*C*FAM*38**MET*32*150.00~EB*C*FAM*38**MET*22*0.00~EB*C*IND*38**MET*32*75.00~EB*C*IND*38**MET*22*0.00~EB*C*FAM*38***32*0.00~EB*C*FAM*38***22*225.00~EB*C*IND*38***32*0.00~EB*C*IND*38***22*75.00~EB*F*IND****29*1717.20~MSG*HCFCWJBEWIUU=HIUJE~EB*C*FAM***MET*32*150.00~MSG*HCFCWJBEWIUU=HIUJE~EB*C*FAM***MET*22*0.00~MSG*HCFCWJBEWIUU=HIUJE~EB*C*IND***MET*32*75.00~MSG*HCFCWJBEWIUU=HIUJE~EB*C*IND***MET*22*0.00~MSG*HCFCWJBEWIUU=HIUJE~EB*C*FAM****32*0.00~MSG*HCFCWJBEWIUU=HIUJE~EB*C*FAM****22*225.00~MSG*HCFCWJBEWIUU=HIUJE~EB*C*IND****32*0.00~MSG*HCFCWJBEWIUU=HIUJE~EB*C*IND****22*75.00~MSG*HCFCWJBEWIUU=HIUJE~EB*F~MSG*FIJBJFV LCLJPU UPCU FPB ILLWO~EB*F************AD:D1351~MSG*UCEPFU TPWIL - LCLTIFCFB TPWILU PFWO, CDEWLUJFV FJUUPT BCCBI~EB*F************AD:D1351~MSG*WJLUB TPWIL - LCLTIFCFB TPWILU PFWO, CDEWLUJFV FJUUPT BCCBI~EB*F~MSG*LLJPL CDBLIEBJPFU ILC FPB EPSCLCU~EB*F~MSG*TLWBJ-SJUJB LLPECULLCU ILC LIJU PF UCIB UIBC~EB*F************AD:D2393~MSG*EPTLPUJBCU ILC FPB UPFFVLIUCU~EB*F************AD:D2750~MSG*LPLECWIJF JU FPB UPFFVLIUCU PF HJELULJUU~EB*F************AD:D2750~MSG*LPLECWIJF JU UPFFVLIUCU PF TPWILU~EB*1*ECH*30*GP*CONAGRA BRANDS INC.******U~MSG*BIC TIDJTLTU IFU UCULEBJHWCU WPL BICUC UCLSJECU TIO HC EPTHJFCU FJBI PBICL BOLCU PW LLPECULLCU, ULEI IU BTI PL LCLJP.~EB*F*IND*23*GP**22*2000.00****U*N~EB*A**23*GP****0.0***U*N~EB*F*IND*41*GP**22*2000.00****U*N~EB*A**41*GP****0.0***U*N~EB*F*IND*25*GP**22*2000.00****U*N~EB*A**25*GP****0.2***U*N~EB*F*IND*26*GP**22*2000.00****U*N~EB*A**26*GP****0.2***U*N~EB*F*IND*24*GP**22*2000.00****U*N~EB*A**24*GP****0.2***U*N~EB*F*IND*39*GP**22*2000.00****U*N~EB*C*IND*39*GP**22*75.00****U*N~EB*A**39*GP****0.5***U*N~EB*F*IND*40*GP**22*2000.00****U*N~EB*A**40*GP****0.2***U*N~EB*F*IND*38*GP**32*2000.00****U*N~EB*C*IND*38*GP**22*75.00****U*N~EB*A**38*GP****0.5***U*N~EB*A***GP****0.0***U*N*AD:D0150~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*N*AD:D0150~DTP*131*U2*17727412~EB*A***GP****0.0***U*N*AD:D0210~HSD*VS*1***34*60~EB*F*IND**GP**22*2000.00****U*N*AD:D0210~EB*A***GP****0.0*S7*26.0*U*N*AD:D0270~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*A***GP****0.0*S8*27.0*U*N*AD:D0270~HSD*VS*1***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*N*AD:D0270~DTP*131*U2*17727412~EB*I**********U*N*AD:D0431~EB*A***GP****0.0***U*N*AD:D1110~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*N*AD:D1110~DTP*131*U2*17727412~EB*A***GP****0.0*S7*16.0*U*N*AD:D1208~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*N*AD:D1208~DTP*131*U2*17727412~EB*A***GP****0.0*S7*19.0*U*N*AD:D1351~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D1351~EB*A***GP****0.0***U*N*AD:D1510~EB*F*IND**GP**22*2000.00****U*N*AD:D1510~EB*A***GP****0.2***U*N*AD:D2140~EB*F*IND**GP**22*2000.00****U*N*AD:D2140~EB*A***GP****0.2***U*N*AD:D2391~EB*F*IND**GP**22*2000.00****U*N*AD:D2391~EB*A***GP****0.5***U*N*AD:D2630~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D2630~EB*C*IND**GP**22*75.00****U*N*AD:D2630~EB*A***GP****0.5***U*N*AD:D2643~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D2643~EB*C*IND**GP**22*75.00****U*N*AD:D2643~EB*A***GP****0.5***U*N*AD:D2750~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D2750~EB*C*IND**GP**22*75.00****U*N*AD:D2750~EB*A***GP****0.5***U*N*AD:D2910~EB*F*IND**GP**22*2000.00****U*N*AD:D2910~EB*C*IND**GP**22*75.00****U*N*AD:D2910~EB*A***GP****0.5***U*N*AD:D2954~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D2954~EB*C*IND**GP**22*75.00****U*N*AD:D2954~EB*A***GP****0.5***U*N*AD:D2980~EB*F*IND**GP**22*2000.00****U*N*AD:D2980~EB*C*IND**GP**22*75.00****U*N*AD:D2980~EB*A***GP****0.2***U*N*AD:D3310~EB*F*IND**GP**22*2000.00****U*N*AD:D3310~EB*A***GP****0.2***U*N*AD:D4260~EB*F*IND**GP**22*2000.00****U*N*AD:D4260~EB*A***GP****0.2***U*N*AD:D4341~EB*F*IND**GP**22*2000.00****U*N*AD:D4341~EB*I**********U*N*AD:D4381~EB*A***GP****0.2***U*N*AD:D4910~HSD*VS*4***23*1~EB*F*IND**GP**22*2000.00****U*N*AD:D4910~EB*A***GP****0.5***U*N*AD:D5110~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D5110~EB*C*IND**GP**22*75.00****U*N*AD:D5110~EB*A***GP****0.2***U*N*AD:D5670~EB*F*IND**GP**22*2000.00****U*N*AD:D5670~EB*A***GP****0.2***U*N*AD:D5751~EB*F*IND**GP**22*2000.00****U*N*AD:D5751~EB*A***GP****0.5***U*N*AD:D6010~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D6010~EB*C*IND**GP**22*75.00****U*N*AD:D6010~EB*A***GP****0.5***U*N*AD:D6013~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D6013~EB*C*IND**GP**22*75.00****U*N*AD:D6013~EB*A***GP****0.5***U*N*AD:D6210~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D6210~EB*C*IND**GP**22*75.00****U*N*AD:D6210~EB*A***GP****0.2***U*N*AD:D7140~EB*F*IND**GP**22*2000.00****U*N*AD:D7140~EB*A***GP****0.2***U*N*AD:D7240~EB*F*IND**GP**22*2000.00****U*N*AD:D7240~EB*I**********U*N*AD:D7880~EB*A***GP****0.5***U*N*AD:D8070~EB*F*IND**GP**32*2000.00****U*N*AD:D8070~EB*C*IND**GP**22*75.00****U*N*AD:D8070~EB*A***GP****0.0***U*N*AD:D9110~EB*F*IND**GP**22*2000.00****U*N*AD:D9110~EB*A***GP****0.2***U*N*AD:D9222~EB*F*IND**GP**22*2000.00****U*N*AD:D9222~EB*I**********U*N*AD:D9944~EB*I**********U*N*AD:D9972~EB*F*IND*23*GP**22*2000.00****U*Y~EB*A**23*GP****0.0***U*Y~EB*F*IND*41*GP**22*2000.00****U*Y~EB*A**41*GP****0.0***U*Y~EB*F*IND*25*GP**22*2000.00****U*Y~EB*A**25*GP****0.2***U*Y~EB*F*IND*26*GP**22*2000.00****U*Y~EB*A**26*GP****0.2***U*Y~EB*F*IND*24*GP**22*2000.00****U*Y~EB*A**24*GP****0.2***U*Y~EB*F*IND*39*GP**22*2000.00****U*Y~EB*C*IND*39*GP**22*75.00****U*Y~EB*A**39*GP****0.5***U*Y~EB*F*IND*40*GP**22*2000.00****U*Y~EB*A**40*GP****0.2***U*Y~EB*F*IND*38*GP**32*2000.00****U*Y~EB*C*IND*38*GP**22*75.00****U*Y~EB*A**38*GP****0.5***U*Y~EB*A***GP****0.0***U*Y*AD:D0150~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*Y*AD:D0150~DTP*131*U2*17727412~EB*CB******37.00****U*Y*AD:D0150~DTP*131*U2*17727412~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.0***U*Y*AD:D0210~HSD*VS*1***34*60~EB*F*IND**GP**22*2000.00****U*Y*AD:D0210~EB*CB******73.00****U*Y*AD:D0210~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.0*S7*26.0*U*Y*AD:D0270~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*A***GP****0.0*S8*27.0*U*Y*AD:D0270~HSD*VS*1***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*Y*AD:D0270~DTP*131*U2*17727412~EB*CB******14.00****U*Y*AD:D0270~DTP*131*U2*17727412~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*I**********U*Y*AD:D0431~EB*A***GP****0.0***U*Y*AD:D1110~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*Y*AD:D1110~DTP*131*U2*17727412~EB*CB******55.00****U*Y*AD:D1110~DTP*131*U2*17727412~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.0*S7*16.0*U*Y*AD:D1208~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*Y*AD:D1208~DTP*131*U2*17727412~EB*CB******24.00****U*Y*AD:D1208~DTP*131*U2*17727412~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.0*S7*19.0*U*Y*AD:D1351~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D1351~EB*CB******30.00****U*Y*AD:D1351~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.0***U*Y*AD:D1510~EB*F*IND**GP**22*2000.00****U*Y*AD:D1510~EB*CB******236.00****U*Y*AD:D1510~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D2140~EB*F*IND**GP**22*2000.00****U*Y*AD:D2140~EB*CB******70.00****U*Y*AD:D2140~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D2391~EB*F*IND**GP**22*2000.00****U*Y*AD:D2391~EB*CB******84.00****U*Y*AD:D2391~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D2630~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D2630~EB*C*IND**GP**22*75.00****U*Y*AD:D2630~EB*CB******595.00****U*Y*AD:D2630~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D2643~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D2643~EB*C*IND**GP**22*75.00****U*Y*AD:D2643~EB*CB******700.00****U*Y*AD:D2643~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D2750~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D2750~EB*C*IND**GP**22*75.00****U*Y*AD:D2750~EB*CB******665.00****U*Y*AD:D2750~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D2910~EB*F*IND**GP**22*2000.00****U*Y*AD:D2910~EB*C*IND**GP**22*75.00****U*Y*AD:D2910~EB*CB******46.00****U*Y*AD:D2910~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D2954~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D2954~EB*C*IND**GP**22*75.00****U*Y*AD:D2954~EB*CB******168.00****U*Y*AD:D2954~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D2980~EB*F*IND**GP**22*2000.00****U*Y*AD:D2980~EB*C*IND**GP**22*75.00****U*Y*AD:D2980~EB*CB******122.00****U*Y*AD:D2980~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D3310~EB*F*IND**GP**22*2000.00****U*Y*AD:D3310~EB*CB******421.00****U*Y*AD:D3310~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D4260~EB*F*IND**GP**22*2000.00****U*Y*AD:D4260~EB*CB******680.00****U*Y*AD:D4260~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D4341~EB*F*IND**GP**22*2000.00****U*Y*AD:D4341~EB*CB******132.00****U*Y*AD:D4341~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*I**********U*Y*AD:D4381~EB*A***GP****0.2***U*Y*AD:D4910~HSD*VS*4***23*1~EB*F*IND**GP**22*2000.00****U*Y*AD:D4910~EB*CB******80.00****U*Y*AD:D4910~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D5110~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D5110~EB*C*IND**GP**22*75.00****U*Y*AD:D5110~EB*CB******835.00****U*Y*AD:D5110~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D5670~EB*F*IND**GP**22*2000.00****U*Y*AD:D5670~EB*CB******264.00****U*Y*AD:D5670~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D5751~EB*F*IND**GP**22*2000.00****U*Y*AD:D5751~EB*CB******251.00****U*Y*AD:D5751~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D6010~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D6010~EB*C*IND**GP**22*75.00****U*Y*AD:D6010~EB*CB******1261.00****U*Y*AD:D6010~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D6013~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D6013~EB*C*IND**GP**22*75.00****U*Y*AD:D6013~EB*CB******1249.00****U*Y*AD:D6013~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D6210~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D6210~EB*C*IND**GP**22*75.00****U*Y*AD:D6210~EB*CB******596.00****U*Y*AD:D6210~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D7140~EB*F*IND**GP**22*2000.00****U*Y*AD:D7140~EB*CB******79.00****U*Y*AD:D7140~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D7240~EB*F*IND**GP**22*2000.00****U*Y*AD:D7240~EB*CB******269.00****U*Y*AD:D7240~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*I**********U*Y*AD:D7880~EB*A***GP****0.5***U*Y*AD:D8070~EB*F*IND**GP**32*2000.00****U*Y*AD:D8070~EB*C*IND**GP**22*75.00****U*Y*AD:D8070~EB*A***GP****0.0***U*Y*AD:D9110~EB*F*IND**GP**22*2000.00****U*Y*AD:D9110~EB*CB******51.00****U*Y*AD:D9110~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D9222~EB*F*IND**GP**22*2000.00****U*Y*AD:D9222~EB*CB******106.00****U*Y*AD:D9222~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*I**********U*Y*AD:D9944~EB*I**********U*Y*AD:D9972~SE*378*0001~GE*1*400512059~IEA*1*400512059~";
			long provNum=ProviderT.CreateProvider("prov1","terry","smith",ssn:"123456789",isUsingTIN:true,nationalProvID:"0123456789");
			Prefs.UpdateLong(PrefName.PracticeDefaultProv,provNum);
			Patient pat=PatientT.CreatePatient(suffix,priProvNum:provNum,birthDate:DateTime.Today);
			//Create clearinghouse, set required fields for benefit request validation, and set as default.
			Clearinghouse ch=ClearinghouseT.CreateClearinghouse("ClaimConnect",commBridge:EclaimsCommBridge.ClaimConnect,eFormat:ElectronicClaimFormat.x837D_5010_dental,isa05:"ZZ",
				isa07:"30",isa08:"BCBSGA",isa15:"P");
			Prefs.UpdateLong(PrefName.ClearinghouseDefaultEligibility,ch.ClearinghouseNum);
			Prefs.RefreshCache();
			Clearinghouses.Insert(ch);
			//Create carrier and set required fields for benefit request validation
			Carrier carrier=CarrierT.CreateCarrier(suffix,"123 boring st","boring","OR","97306","1234",arrayTrustedEtrans:TrustedEtransTypes.RealTimeEligibility);
			Carriers.RefreshCache();
			InsPlan insPlan=InsPlanT.CreateInsPlan(carrier.CarrierNum,groupNum:"XYZ123");//Group number should be >3 characters so it passes insverify validation
			InsSub insSub=InsSubT.CreateInsSub(pat.PatNum,insPlan.PlanNum);
			PatPlan patPlan=PatPlanT.CreatePatPlan(1,pat.PatNum,insSub.InsSubNum);
			Operatory op=OperatoryT.CreateOperatory();
			//Create benefits for the plan
			BenefitT.CreateAnnualMax(insPlan.PlanNum,BenefitCoverageLevel.Individual,2000);
			BenefitT.CreateDeductibleGeneral(insPlan.PlanNum,BenefitCoverageLevel.Individual,75);
			BenefitT.CreateAnnualMax(insPlan.PlanNum,BenefitCoverageLevel.Family,2000);
			BenefitT.CreateDeductibleGeneral(insPlan.PlanNum,BenefitCoverageLevel.Family,225);
			AppointmentT.CreateAppointment(pat.PatNum,DateTime.Today,op.OperatoryNum,provNum);
			List<InsVerify> listInsVerifies=InsVerifies.TryBatchPatInsVerify();
			//Should only be one patient in the list and they should have passed validation.
			Assert.IsTrue(listInsVerifies.FirstOrDefault().BatchVerifyState==BatchInsVerifyState.Success);
		}

		[TestMethod]
		public void InsVerifies_MetLifeExample_ShouldMakeInsuranceAdjustment() {
			AppointmentT.ClearAppointmentTable();
			CarrierT.ClearCarrierTable();
			string suffix=MethodBase.GetCurrentMethod().Name;
			x270Controller.FakeResponseOverride271=@"ISA*00*          *00*          *30*330989922      *ZZ*810624427      *191217*1337*U*00401*401633168*0*P*:~GS*HB*330989922*330989922*20191217*1337*401633168*X*004010X092A1~ST*271*0001~BHT*6666*44*164088400EQX*66414646*4886~HL*4**66*4~NM1*IH*6*FQWYAXQ*****IA*07160~HL*6*4*64*4~NM1*4I*4*IHLXQLLALPDY NQPWDY DYYADPSQ YYS*****RR*4616701660~HL*8*6*66*6~TRN*6*4*4661810600~NM1*AY*4*LSREDX*XLPPAQ*G***FA*606817866~
				REF*0I*417711*LRAL IPXYAS QFIYLTQQL HQWAHQFQ~N3*44761 HLDN 416~N4*SQSAY*LR*170641866~DMG*N0*41806867*X~DTP*781*N0*66466464~DTP*810*N0*66416464~DTP*816*N0*66414684~EB*F*IND*24***29*1887.00~EB*C*FAM*24**MET*32*234.00~EB*C*FAM*24**MET*22*0.00~EB*C*IND*24**MET*32*84.00~EB*C*IND*24**MET*22*0.00~EB*C*FAM*24***32*0.00~EB*C*FAM*24***22*100.00~EB*C*IND*24***32*0.00~EB*C*IND*24***22*50.00~EB*F*IND****29*1887.00~MSG*XQPQXAWSYDLL=XDLAS~EB*C*FAM***MET*32*234.00~MSG*XQPQXAWSYDLL=XDLAS~EB*C*FAM***MET*22*0.00~MSG*XQPQXAWSYDLL=XDLAS~EB*C*IND***MET*32*84.00~MSG*XQPQXAWSYDLL=XDLAS~EB*C*IND***MET*22*0.00~MSG*XQPQXAWSYDLL=XDLAS~EB*C*FAM****32*0.00~MSG*XQPQXAWSYDLL=XDLAS~EB*C*FAM****22*100.00~MSG*XQPQXAWSYDLL=XDLAS~EB*C*IND****32*0.00~MSG*XQPQXAWSYDLL=XDLAS~EB*C*IND****22*50.00~MSG*XQPQXAWSYDLL=XDLAS~EB*F~MSG*EDAWAPH IQHALN NLQL PLW DIIYT~EB*F************AD:D1351~MSG*LQSLPN FLYDH - IQHFDPQPW FLYDHL LPYT, QRSYPNAPH EALNLF WQQWR~EB*F************AD:D1351~MSG*XAHLW FLYDH - IQHFDPQPW FLYDHL LPYT, QRSYPNAPH EALNLF WQQWR~EB*F~MSG*IHALH QRWHDSWALPL DHQ SLEQHQN~EB*F~MSG*FPYWA-EALAW IHLSQNPHQL DHQ IDAN LP LQDW NDWQ~EB*F************AD:D2393~MSG*SLFILLAWQL DHQ PLW NLEPHHDNQN~EB*F************AD:D2750~MSG*ILHSQYDAP AL PLW NLEPHHDNQN LP XASPLIANL~EB*F************AD:D2750~MSG*ILHSQYDAP AL NLEPHHDNQN LP FLYDHL~EB*1*ESP*30*GP*OHIO PUBLIC EMPLOYEES RETIREME******N~MSG*PL XAYAPH YAFAW~EB*F*IND*23*GP**22*1250.00****U*N~MSG*AP DNNAWALP, D $6666 APNAEANPDY XQPQXAW IQHALN FDRAFPF DIIYAQL LX ERASR $448 RDL XQQP PLQN.~EB*A**23*GP****0.0***U*N~EB*F*IND*41*GP**22*1250.00****U*N~EB*A**41*GP****0.0***U*N~EB*F*IND*25*GP**22*1250.00****U*N~EB*C*IND*25*GP**22*50.00****U*N~EB*A**25*GP****0.35***U*N~EB*F*IND*26*GP**22*1250.00****U*N~EB*C*IND*26*GP**22*50.00****U*N~EB*A**26*GP****0.35***U*N~EB*F*IND*24*GP**22*1250.00****U*N~EB*C*IND*24*GP**22*50.00****U*N~EB*A**24*GP****0.35***U*N~EB*F*IND*39*GP**22*1250.00****U*N~EB*C*IND*39*GP**22*50.00****U*N~EB*A**39*GP****0.65***U*N~EB*F*IND*40*GP**22*1250.00****U*N~EB*C*IND*40*GP**22*50.00****U*N~EB*A**40*GP****0.65***U*N~EB*A**38*GP****1.0***U*N~EB*A***GP****0.0***U*N*AD:D0150~HSD*VS*2***23*1~DTP*166*N0*66416067~EB*F*IND**GP**22*1250.00****U*N*AD:D0150~DTP*166*N0*66416067~EB*A***GP****0.0***U*N*AD:D0210~HSD*VS*1***34*60~DTP*166*N0*66404640~EB*F*IND**GP**22*1250.00****U*N*AD:D0210~DTP*166*N0*66404640~EB*A***GP****0.0***U*N*AD:D0270~HSD*VS*1***23*1~DTP*166*N0*66416067~EB*F*IND**GP**22*1250.00****U*N*AD:D0270~DTP*166*N0*66416067~EB*I**********U*N*AD:D0431~EB*A***GP****0.0***U*N*AD:D1110~HSD*VS*2***23*1~DTP*166*N0*66416067~EB*F*IND**GP**22*1250.00****U*N*AD:D1110~DTP*166*N0*66416067~EB*A***GP****0.0*S7*16.0*U*N*AD:D1208~HSD*VS*1***23*1~EB*F*IND**GP**22*1250.00****U*N*AD:D1208~EB*A***GP****0.0*S7*19.0*U*N*AD:D1351~HSD*VS*1***34*60~EB*F*IND**GP**22*1250.00****U*N*AD:D1351~EB*A***GP****0.0*S7*14.0*U*N*AD:D1510~HSD*VS*1***23*14~EB*F*IND**GP**22*1250.00****U*N*AD:D1510~EB*A***GP****0.35***U*N*AD:D2140~EB*F*IND**GP**22*1250.00****U*N*AD:D2140~EB*C*IND**GP**22*50.00****U*N*AD:D2140~EB*A***GP****0.35***U*N*AD:D2391~EB*F*IND**GP**22*1250.00****U*N*AD:D2391~EB*C*IND**GP**22*50.00****U*N*AD:D2391~EB*A***GP****0.65***U*N*AD:D2630~HSD*VS*1***23*10~EB*F*IND**GP**22*1250.00****U*N*AD:D2630~EB*C*IND**GP**22*50.00****U*N*AD:D2630~EB*A***GP****0.65***U*N*AD:D2643~HSD*VS*1***23*10~EB*F*IND**GP**22*1250.00****U*N*AD:D2643~EB*C*IND**GP**22*50.00****U*N*AD:D2643~EB*A***GP****0.65***U*N*AD:D2750~HSD*VS*1***23*10~EB*F*IND**GP**22*1250.00****U*N*AD:D2750~EB*C*IND**GP**22*50.00****U*N*AD:D2750~EB*A***GP****0.35***U*N*AD:D2910~HSD*VS*1***34*12~EB*F*IND**GP**22*1250.00****U*N*AD:D2910~EB*C*IND**GP**22*50.00****U*N*AD:D2910~EB*A***GP****0.65***U*N*AD:D2954~HSD*VS*1***23*10~EB*F*IND**GP**22*1250.00****U*N*AD:D2954~EB*C*IND**GP**22*50.00****U*N*AD:D2954~EB*A***GP****0.65***U*N*AD:D2980~EB*F*IND**GP**22*1250.00****U*N*AD:D2980~EB*C*IND**GP**22*50.00****U*N*AD:D2980~EB*A***GP****0.35***U*N*AD:D3310~EB*F*IND**GP**22*1250.00****U*N*AD:D3310~EB*C*IND**GP**22*50.00****U*N*AD:D3310~EB*A***GP****0.65***U*N*AD:D4260~HSD*VS*1***23*3~EB*F*IND**GP**22*1250.00****U*N*AD:D4260~EB*C*IND**GP**22*50.00****U*N*AD:D4260~EB*A***GP****0.35***U*N*AD:D4341~HSD*VS*1***34*24~EB*F*IND**GP**22*1250.00****U*N*AD:D4341~EB*C*IND**GP**22*50.00****U*N*AD:D4341~EB*A***GP****0.65***U*N*AD:D4381~EB*F*IND**GP**22*1250.00****U*N*AD:D4381~EB*C*IND**GP**22*50.00****U*N*AD:D4381~EB*A***GP****0.35***U*N*AD:D4910~HSD*VS*4***23*1~EB*F*IND**GP**22*1250.00****U*N*AD:D4910~EB*C*IND**GP**22*50.00****U*N*AD:D4910~EB*A***GP****0.65***U*N*AD:D5110~HSD*VS*1***23*10~EB*F*IND**GP**22*1250.00****U*N*AD:D5110~EB*C*IND**GP**22*50.00****U*N*AD:D5110~EB*A***GP****0.65***U*N*AD:D5670~EB*F*IND**GP**22*1250.00****U*N*AD:D5670~EB*C*IND**GP**22*50.00****U*N*AD:D5670~EB*A***GP****0.65***U*N*AD:D5751~EB*F*IND**GP**22*1250.00****U*N*AD:D5751~EB*C*IND**GP**22*50.00****U*N*AD:D5751~EB*A***GP****0.65***U*N*AD:D6010~HSD*VS*1***23*10~EB*F*IND**GP**22*1250.00****U*N*AD:D6010~EB*C*IND**GP**22*50.00****U*N*AD:D6010~EB*A***GP****0.65***U*N*AD:D6013~HSD*VS*1***23*10~EB*F*IND**GP**22*1250.00****U*N*AD:D6013~EB*C*IND**GP**22*50.00****U*N*AD:D6013~EB*A***GP****0.65***U*N*AD:D6210~HSD*VS*1***23*10~EB*F*IND**GP**22*1250.00****U*N*AD:D6210~EB*C*IND**GP**22*50.00****U*N*AD:D6210~EB*A***GP****0.35***U*N*AD:D7140~EB*F*IND**GP**22*1250.00****U*N*AD:D7140~EB*C*IND**GP**22*50.00****U*N*AD:D7140~EB*A***GP****0.65***U*N*AD:D7240~EB*F*IND**GP**22*1250.00****U*N*AD:D7240~EB*C*IND**GP**22*50.00****U*N*AD:D7240~EB*I**********U*N*AD:D7880~EB*I**********U*N*AD:D8070~EB*A***GP****0.0***U*N*AD:D9110~EB*F*IND**GP**22*1250.00****U*N*AD:D9110~EB*A***GP****0.65***U*N*AD:D9222~EB*F*IND**GP**22*1250.00****U*N*AD:D9222~EB*C*IND**GP**22*50.00****U*N*AD:D9222~EB*A***GP****0.65***U*N*AD:D9944~HSD*VS*1***34*24~EB*F*IND**GP**22*1250.00****U*N*AD:D9944~EB*C*IND**GP**22*50.00****U*N*AD:D9944~EB*I**********U*N*AD:D9972~EB*F*IND*23*GP**22*2000.00****U*Y~MSG*AP DNNAWALP, D $6666 APNAEANPDY XQPQXAW IQHALN FDRAFPF DIIYAQL LX ERASR $448 RDL XQQP PLQN.~EB*A**23*GP****0.0***U*Y~EB*F*IND*41*GP**22*2000.00****U*Y~EB*A**41*GP****0.0***U*Y~EB*F*IND*25*GP**22*2000.00****U*Y~EB*A**25*GP****0.2***U*Y~EB*F*IND*26*GP**22*2000.00****U*Y~EB*A**26*GP****0.2***U*Y~EB*F*IND*24*GP**22*2000.00****U*Y~EB*A**24*GP****0.2***U*Y~EB*F*IND*39*GP**22*2000.00****U*Y~EB*A**39*GP****0.5***U*Y~EB*F*IND*40*GP**22*2000.00****U*Y~EB*A**40*GP****0.5***U*Y~EB*A**38*GP****1.0***U*Y~EB*A***GP****0.0***U*Y*AD:D0150~HSD*VS*2***23*1~DTP*166*N0*66416067~EB*F*IND**GP**22*2000.00****U*Y*AD:D0150~DTP*166*N0*66416067~EB*CB******37.00****U*Y*AD:D0150~DTP*166*N0*66416067~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.0***U*Y*AD:D0210~HSD*VS*1***34*60~DTP*166*N0*66404640~EB*F*IND**GP**22*2000.00****U*Y*AD:D0210~DTP*166*N0*66404640~EB*CB******73.00****U*Y*AD:D0210~DTP*166*N0*66404640~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.0***U*Y*AD:D0270~HSD*VS*1***23*1~DTP*166*N0*66416067~EB*F*IND**GP**22*2000.00****U*Y*AD:D0270~DTP*166*N0*66416067~EB*CB******14.00****U*Y*AD:D0270~DTP*166*N0*66416067~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*I**********U*Y*AD:D0431~EB*A***GP****0.0***U*Y*AD:D1110~HSD*VS*2***23*1~DTP*166*N0*66416067~EB*F*IND**GP**22*2000.00****U*Y*AD:D1110~DTP*166*N0*66416067~EB*CB******55.00****U*Y*AD:D1110~DTP*166*N0*66416067~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.0*S7*16.0*U*Y*AD:D1208~HSD*VS*1***23*1~EB*F*IND**GP**22*2000.00****U*Y*AD:D1208~EB*CB******24.00****U*Y*AD:D1208~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.0*S7*19.0*U*Y*AD:D1351~HSD*VS*1***34*60~EB*F*IND**GP**22*2000.00****U*Y*AD:D1351~EB*CB******30.00****U*Y*AD:D1351~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.0*S7*14.0*U*Y*AD:D1510~HSD*VS*1***23*14~EB*F*IND**GP**22*2000.00****U*Y*AD:D1510~EB*CB******236.00****U*Y*AD:D1510~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.2***U*Y*AD:D2140~EB*F*IND**GP**22*2000.00****U*Y*AD:D2140~EB*CB******70.00****U*Y*AD:D2140~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.2***U*Y*AD:D2391~EB*F*IND**GP**22*2000.00****U*Y*AD:D2391~EB*CB******84.00****U*Y*AD:D2391~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D2630~HSD*VS*1***23*10~EB*F*IND**GP**22*2000.00****U*Y*AD:D2630~EB*CB******595.00****U*Y*AD:D2630~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D2643~HSD*VS*1***23*10~EB*F*IND**GP**22*2000.00****U*Y*AD:D2643~EB*CB******700.00****U*Y*AD:D2643~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D2750~HSD*VS*1***23*10~EB*F*IND**GP**22*2000.00****U*Y*AD:D2750~EB*CB******665.00****U*Y*AD:D2750~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.2***U*Y*AD:D2910~HSD*VS*1***34*12~EB*F*IND**GP**22*2000.00****U*Y*AD:D2910~EB*CB******46.00****U*Y*AD:D2910~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D2954~HSD*VS*1***23*10~EB*F*IND**GP**22*2000.00****U*Y*AD:D2954~EB*CB******168.00****U*Y*AD:D2954~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D2980~EB*F*IND**GP**22*2000.00****U*Y*AD:D2980~EB*CB******122.00****U*Y*AD:D2980~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.2***U*Y*AD:D3310~EB*F*IND**GP**22*2000.00****U*Y*AD:D3310~EB*CB******421.00****U*Y*AD:D3310~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D4260~HSD*VS*1***23*3~EB*F*IND**GP**22*2000.00****U*Y*AD:D4260~EB*CB******680.00****U*Y*AD:D4260~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.2***U*Y*AD:D4341~HSD*VS*1***34*24~EB*F*IND**GP**22*2000.00****U*Y*AD:D4341~EB*CB******132.00****U*Y*AD:D4341~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D4381~EB*F*IND**GP**22*2000.00****U*Y*AD:D4381~EB*CB******55.00****U*Y*AD:D4381~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.2***U*Y*AD:D4910~HSD*VS*4***23*1~EB*F*IND**GP**22*2000.00****U*Y*AD:D4910~EB*CB******80.00****U*Y*AD:D4910~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D5110~HSD*VS*1***23*10~EB*F*IND**GP**22*2000.00****U*Y*AD:D5110~EB*CB******835.00****U*Y*AD:D5110~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D5670~EB*F*IND**GP**22*2000.00****U*Y*AD:D5670~EB*CB******264.00****U*Y*AD:D5670~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D5751~EB*F*IND**GP**22*2000.00****U*Y*AD:D5751~EB*CB******251.00****U*Y*AD:D5751~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D6010~HSD*VS*1***23*10~EB*F*IND**GP**22*2000.00****U*Y*AD:D6010~EB*CB******1261.00****U*Y*AD:D6010~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D6013~HSD*VS*1***23*10~EB*F*IND**GP**22*2000.00****U*Y*AD:D6013~EB*CB******1249.00****U*Y*AD:D6013~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D6210~HSD*VS*1***23*10~EB*F*IND**GP**22*2000.00****U*Y*AD:D6210~EB*CB******596.00****U*Y*AD:D6210~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.2***U*Y*AD:D7140~EB*F*IND**GP**22*2000.00****U*Y*AD:D7140~EB*CB******79.00****U*Y*AD:D7140~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D7240~EB*F*IND**GP**22*2000.00****U*Y*AD:D7240~EB*CB******269.00****U*Y*AD:D7240~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*I**********U*Y*AD:D7880~EB*I**********U*Y*AD:D8070~EB*A***GP****0.0***U*Y*AD:D9110~EB*F*IND**GP**22*2000.00****U*Y*AD:D9110~EB*CB******51.00****U*Y*AD:D9110~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D9222~EB*F*IND**GP**22*2000.00****U*Y*AD:D9222~EB*CB******106.00****U*Y*AD:D9222~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*A***GP****0.5***U*Y*AD:D9944~HSD*VS*1***34*24~EB*F*IND**GP**22*2000.00****U*Y*AD:D9944~EB*CB******334.00****U*Y*AD:D9944~MSG*XQPQXAW DFLPPW = FDRAFPF DYYLEDXYQ SRDHHQ~EB*I**********U*Y*AD:D9972~SE*376*0001~GE*1*401633168~IEA*1*401633168~";
			long provNum=ProviderT.CreateProvider("prov1","terry","smith",ssn:"123456789",isUsingTIN:true,nationalProvID:"0123456789");
			Prefs.UpdateLong(PrefName.PracticeDefaultProv,provNum);
			Patient pat=PatientT.CreatePatient(suffix,priProvNum:provNum,birthDate:DateTime.Today);
			//Create clearinghouse, set required fields for benefit request validation, and set as default.
			Clearinghouse ch=ClearinghouseT.CreateClearinghouse("ClaimConnect",commBridge:EclaimsCommBridge.ClaimConnect,eFormat:ElectronicClaimFormat.x837D_5010_dental,isa05:"ZZ",
				isa07:"30",isa08:"BCBSGA",isa15:"P");
			Prefs.UpdateLong(PrefName.ClearinghouseDefaultEligibility,ch.ClearinghouseNum);
			Prefs.RefreshCache();
			Clearinghouses.Insert(ch);
			//Create carrier and set required fields for benefit request validation
			Carrier carrier=CarrierT.CreateCarrier(suffix,"123 boring st","boring","OR","97306","1234",arrayTrustedEtrans:TrustedEtransTypes.RealTimeEligibility);
			Carriers.RefreshCache();
			InsPlan insPlan=InsPlanT.CreateInsPlan(carrier.CarrierNum,groupNum:"XYZ123");//Group number should be >3 characters so it passes insverify validation
			InsSub insSub=InsSubT.CreateInsSub(pat.PatNum,insPlan.PlanNum);
			PatPlan patPlan=PatPlanT.CreatePatPlan(1,pat.PatNum,insSub.InsSubNum);
			Operatory op=OperatoryT.CreateOperatory();
			//Create benefits for the plan
			BenefitT.CreateAnnualMax(insPlan.PlanNum,2000);
			BenefitT.CreateDeductibleGeneral(insPlan.PlanNum,BenefitCoverageLevel.Individual,50);
			BenefitT.CreateDeductibleGeneral(insPlan.PlanNum,BenefitCoverageLevel.Family,100);
			AppointmentT.CreateAppointment(pat.PatNum,DateTime.Today,op.OperatoryNum,provNum);
			List<InsVerify> listInsVerifies=InsVerifies.TryBatchPatInsVerify();
			List<ClaimProc> listClaimProcs=ClaimProcs.Refresh(patPlan.PatNum);
			ClaimProc insuranceAdj=listClaimProcs.Find(x=>x.InsSubNum==insSub.InsSubNum && x.Status==ClaimProcStatus.Adjustment);
			//An insurance adjustment for $113 should have been made.
			Assert.IsTrue(listInsVerifies.FirstOrDefault().BatchVerifyState==BatchInsVerifyState.Success);
			Assert.IsTrue(insuranceAdj.InsPayAmt==113);
		}

		[TestMethod]
		public void InsVerifies_MetLifeExample_ShouldPassAllValidation() {
			AppointmentT.ClearAppointmentTable();
			CarrierT.ClearCarrierTable();
			string suffix=MethodBase.GetCurrentMethod().Name;
			x270Controller.FakeResponseOverride271=@"ISA*00*          *00*          *30*330989922      *ZZ*810624427      *191218*1331*U*00401*401956009*0*P*:~GS*HB*330989922*330989922*20191218*1331*401956009*X*004010X092A1~ST*271*0001~BHT*1177*77*117317113DBT*71737775*7777~HL*7**71*7~NM1*OA*7*GBXPOQB*****OO*71365~HL*7*7*77*7~NM1*7O*7*OAVQBDDOVYWP KBYXWP WPPOWYGB VQ PBV*****WW*7577311317~HL*7*7*77*7~NM1*OP*7*DBDPBI*DWWAVY*X***GO*157657371~REF*7O*715756*GVTT GVJYXI DGWVVP KODXAOGX~N3*617 WJYXBAD XAGB~N4*KWPPWD*PW*717163176~DMG*K5*73751776*Q~HL*1*7*77*1~TRN*7*7*7577777173~NM1*17*7*DBDPBI*AVI*D***GO*157657371~N3*617 WJYXBAD XAGB~N4*KWPPWD*PW*717163176~DMG*K5*73751777*G~INS*Y*17~DTP*539*D8*20150101~DTP*346*D8*20150101~EB*F*IND*24***29*725.80~EB*C*FAM*24**MET*32*186.00~EB*C*FAM*24**MET*22*50.00~EB*C*IND*24**MET*32*150.00~EB*C*IND*24**MET*22*50.00~EB*C*FAM*24***32*0.00~EB*C*FAM*24***22*150.00~EB*C*IND*24***32*0.00~EB*C*IND*24***22*50.00~EB*F*IND*38***33*1000.00~EB*C*FAM*38**MET*32*0.00~EB*C*FAM*38**MET*22*0.00~EB*C*IND*38**MET*32*0.00~EB*C*IND*38**MET*22*0.00~EB*C*FAM*38***32*0.00~EB*C*FAM*38***22*0.00~EB*C*IND*38***32*0.00~EB*C*IND*38***22*0.00~EB*F*IND****29*725.80~MSG*TBYBQOXGPWDD=TWDOG~EB*C*FAM***MET*32*186.00~MSG*TBYBQOXGPWDD=TWDOG~EB*C*FAM***MET*22*50.00~MSG*TBYBQOXGPWDD=TWDOG~EB*C*IND***MET*32*150.00~MSG*TBYBQOXGPWDD=TWDOG~EB*C*IND***MET*22*50.00~MSG*TBYBQOXGPWDD=TWDOG~EB*C*FAM****32*0.00~MSG*TBYBQOXGPWDD=TWDOG~EB*C*FAM****22*150.00~MSG*TBYBQOXGPWDD=TWDOG~EB*C*IND****32*0.00~MSG*TBYBQOXGPWDD=TWDOG~EB*C*IND****22*50.00~MSG*TBYBQOXGPWDD=TWDOG~EB*F~MSG*DWOXOYP OBAOVK WOOPOBD~EB*F************AD:D1351~MSG*DBGVYK GVPWA - OBAGWYBYX GVPWAD VYPI, BWGPJKOYP DODKVG XBBXW~EB*F************AD:D1351~MSG*QOADX GVPWA - OBAGWYBYX GVPWAD VYPI, BWGPJKOYP DODKVG XBBXW~EB*F~MSG*OAOVA BWXAWGXOVYD WAB YVX GVQBABK~EB*F~MSG*GJPXO-QODOX OAVGBKJABD WAB OWOK VY DBWX KWXB~EB*F************AD:D2393~MSG*GVGOVDOXBD WAB KVDYPAWKBK~EB*F************AD:D2750~MSG*OVAGBPWOY OD YVX KVDYPAWKBK VY TOGJDOOKD~EB*F************AD:D2750~MSG*OVAGBPWOY OD KVDYPAWKBK VY GVPWAD~EB*1*FAM*30*GP*COBB COUNTY SCHOOL DISTRICT******U~MSG*XWB GWWOGJGD WYK KBKJGXOTPBD QVA XWBDB DBAQOGBD GWI TB GVGTOYBK DOXW VXWBA XIOBD VQ OAVGBKJABD, DJGW WD XGF VA OBAOV.~EB*F*IND*23*GP**22*1000.00****U*N~EB*A**23*GP****0.0***U*N~EB*F*IND*41*GP**22*1000.00****U*N~EB*A**41*GP****0.0***U*N~EB*F*IND*25*GP**22*1000.00****U*N~EB*C*IND*25*GP**22*50.00****U*N~EB*A**25*GP****0.2***U*N~EB*F*IND*26*GP**22*1000.00****U*N~EB*C*IND*26*GP**22*50.00****U*N~EB*A**26*GP****0.2***U*N~EB*F*IND*24*GP**22*1000.00****U*N~EB*C*IND*24*GP**22*50.00****U*N~EB*A**24*GP****0.2***U*N~EB*F*IND*39*GP**22*1000.00****U*N~EB*C*IND*39*GP**22*50.00****U*N~EB*A**39*GP****0.5***U*N~EB*F*IND*40*GP**22*1000.00****U*N~EB*C*IND*40*GP**22*50.00****U*N~EB*A**40*GP****0.2***U*N~EB*F*IND*38*GP**32*1000.00****U*N~EB*A**38*GP****0.5***U*N~EB*A***GP****0.0***U*N*AD:D0150~HSD*VS*2***23*1~DTP*472*D8*20190717~EB*F*IND**GP**22*1000.00****U*N*AD:D0150~DTP*472*D8*20190717~EB*A***GP****0.0***U*N*AD:D0210~HSD*VS*1***23*3~DTP*472*D8*20170622~EB*F*IND**GP**22*1000.00****U*N*AD:D0210~DTP*472*D8*20170622~EB*A***GP****0.0***U*N*AD:D0270~HSD*VS*2***23*1~DTP*472*D8*20181128~EB*F*IND**GP**22*1000.00****U*N*AD:D0270~DTP*472*D8*20181128~EB*I**********U*N*AD:D0431~EB*A***GP****0.0***U*N*AD:D1110~HSD*VS*2***23*1~DTP*472*D8*20181128~EB*F*IND**GP**22*1000.00****U*N*AD:D1110~DTP*472*D8*20181128~EB*A***GP****0.0*S7*19.0*U*N*AD:D1208~HSD*VS*1***23*1~EB*F*IND**GP**22*1000.00****U*N*AD:D1208~EB*A***GP****0.0*S7*14.0*U*N*AD:D1351~HSD*VS*1***23*3~EB*F*IND**GP**22*1000.00****U*N*AD:D1351~EB*A***GP****0.0*S7*19.0*U*N*AD:D1510~HSD*VS*1***23*99~EB*F*IND**GP**22*1000.00****U*N*AD:D1510~EB*A***GP****0.2***U*N*AD:D2140~HSD*VS*1***34*24~EB*F*IND**GP**22*1000.00****U*N*AD:D2140~EB*C*IND**GP**22*50.00****U*N*AD:D2140~EB*A***GP****0.2***U*N*AD:D2391~HSD*VS*1***34*24~EB*F*IND**GP**22*1000.00****U*N*AD:D2391~EB*C*IND**GP**22*50.00****U*N*AD:D2391~EB*A***GP****0.5***U*N*AD:D2630~HSD*VS*1***23*5~EB*F*IND**GP**22*1000.00****U*N*AD:D2630~EB*C*IND**GP**22*50.00****U*N*AD:D2630~EB*A***GP****0.5***U*N*AD:D2643~HSD*VS*1***23*5~EB*F*IND**GP**22*1000.00****U*N*AD:D2643~EB*C*IND**GP**22*50.00****U*N*AD:D2643~EB*A***GP****0.5***U*N*AD:D2750~HSD*VS*1***23*5~EB*F*IND**GP**22*1000.00****U*N*AD:D2750~EB*C*IND**GP**22*50.00****U*N*AD:D2750~EB*A***GP****0.5***U*N*AD:D2910~HSD*VS*1***34*12~EB*F*IND**GP**22*1000.00****U*N*AD:D2910~EB*C*IND**GP**22*50.00****U*N*AD:D2910~EB*A***GP****0.5***U*N*AD:D2954~HSD*VS*1***23*5~EB*F*IND**GP**22*1000.00****U*N*AD:D2954~EB*C*IND**GP**22*50.00****U*N*AD:D2954~EB*A***GP****0.5***U*N*AD:D2980~HSD*VS*1***34*12~EB*F*IND**GP**22*1000.00****U*N*AD:D2980~EB*C*IND**GP**22*50.00****U*N*AD:D2980~EB*A***GP****0.2***U*N*AD:D3310~HSD*VS*1***34*24~EB*F*IND**GP**22*1000.00****U*N*AD:D3310~EB*C*IND**GP**22*50.00****U*N*AD:D3310~EB*A***GP****0.2***U*N*AD:D4260~HSD*VS*1***34*36~EB*F*IND**GP**22*1000.00****U*N*AD:D4260~EB*C*IND**GP**22*50.00****U*N*AD:D4260~EB*A***GP****0.2***U*N*AD:D4341~HSD*VS*1***34*24~DTP*472*D8*20171118~EB*F*IND**GP**22*1000.00****U*N*AD:D4341~DTP*472*D8*20171118~EB*C*IND**GP**22*50.00****U*N*AD:D4341~DTP*472*D8*20171118~EB*I**********U*N*AD:D4381~EB*A***GP****0.2***U*N*AD:D4910~HSD*VS*2***23*1~DTP*472*D8*20190611~EB*F*IND**GP**22*1000.00****U*N*AD:D4910~DTP*472*D8*20190611~EB*C*IND**GP**22*50.00****U*N*AD:D4910~DTP*472*D8*20190611~EB*A***GP****0.5***U*N*AD:D5110~HSD*VS*1***23*10~EB*F*IND**GP**22*1000.00****U*N*AD:D5110~EB*C*IND**GP**22*50.00****U*N*AD:D5110~EB*A***GP****0.5***U*N*AD:D5670~HSD*VS*1***34*12~EB*F*IND**GP**22*1000.00****U*N*AD:D5670~EB*C*IND**GP**22*50.00****U*N*AD:D5670~EB*A***GP****0.5***U*N*AD:D5751~EB*F*IND**GP**22*1000.00****U*N*AD:D5751~EB*C*IND**GP**22*50.00****U*N*AD:D5751~EB*A***GP****0.5***U*N*AD:D6010~HSD*VS*1***23*5~EB*F*IND**GP**22*1000.00****U*N*AD:D6010~EB*C*IND**GP**22*50.00****U*N*AD:D6010~EB*A***GP****0.5***U*N*AD:D6013~HSD*VS*1***23*5~EB*F*IND**GP**22*1000.00****U*N*AD:D6013~EB*C*IND**GP**22*50.00****U*N*AD:D6013~EB*A***GP****0.5***U*N*AD:D6210~HSD*VS*1***34*84~EB*F*IND**GP**22*1000.00****U*N*AD:D6210~EB*C*IND**GP**22*50.00****U*N*AD:D6210~EB*A***GP****0.2***U*N*AD:D7140~EB*F*IND**GP**22*1000.00****U*N*AD:D7140~EB*C*IND**GP**22*50.00****U*N*AD:D7140~EB*A***GP****0.2***U*N*AD:D7240~EB*F*IND**GP**22*1000.00****U*N*AD:D7240~EB*C*IND**GP**22*50.00****U*N*AD:D7240~EB*I**********U*N*AD:D7880~EB*A***GP****0.5*S7*19.0*U*N*AD:D8070~EB*F*IND**GP**32*1000.00****U*N*AD:D8070~EB*A***GP****0.2***U*N*AD:D9110~EB*F*IND**GP**22*1000.00****U*N*AD:D9110~EB*C*IND**GP**22*50.00****U*N*AD:D9110~EB*A***GP****0.2***U*N*AD:D9222~EB*F*IND**GP**22*1000.00****U*N*AD:D9222~EB*C*IND**GP**22*50.00****U*N*AD:D9222~EB*I**********U*N*AD:D9944~EB*I**********U*N*AD:D9972~EB*F*IND*23*GP**22*1000.00****U*Y~EB*A**23*GP****0.0***U*Y~EB*F*IND*41*GP**22*1000.00****U*Y~EB*A**41*GP****0.0***U*Y~EB*F*IND*25*GP**22*1000.00****U*Y~EB*C*IND*25*GP**22*50.00****U*Y~EB*A**25*GP****0.2***U*Y~EB*F*IND*26*GP**22*1000.00****U*Y~EB*C*IND*26*GP**22*50.00****U*Y~EB*A**26*GP****0.2***U*Y~EB*F*IND*24*GP**22*1000.00****U*Y~EB*C*IND*24*GP**22*50.00****U*Y~EB*A**24*GP****0.2***U*Y~EB*F*IND*39*GP**22*1000.00****U*Y~EB*C*IND*39*GP**22*50.00****U*Y~EB*A**39*GP****0.5***U*Y~EB*F*IND*40*GP**22*1000.00****U*Y~EB*C*IND*40*GP**22*50.00****U*Y~EB*A**40*GP****0.2***U*Y~EB*F*IND*38*GP**32*1000.00****U*Y~EB*A**38*GP****0.5***U*Y~EB*A***GP****0.0***U*Y*AD:D0150~HSD*VS*2***23*1~DTP*472*D8*20190717~EB*F*IND**GP**22*1000.00****U*Y*AD:D0150~DTP*472*D8*20190717~EB*CB******41.00****U*Y*AD:D0150~DTP*472*D8*20190717~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.0***U*Y*AD:D0210~HSD*VS*1***23*3~DTP*472*D8*20170622~EB*F*IND**GP**22*1000.00****U*Y*AD:D0210~DTP*472*D8*20170622~EB*CB******81.00****U*Y*AD:D0210~DTP*472*D8*20170622~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.0***U*Y*AD:D0270~HSD*VS*2***23*1~DTP*472*D8*20181128~EB*F*IND**GP**22*1000.00****U*Y*AD:D0270~DTP*472*D8*20181128~EB*CB******16.00****U*Y*AD:D0270~DTP*472*D8*20181128~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*I**********U*Y*AD:D0431~EB*A***GP****0.0***U*Y*AD:D1110~HSD*VS*2***23*1~DTP*472*D8*20181128~EB*F*IND**GP**22*1000.00****U*Y*AD:D1110~DTP*472*D8*20181128~EB*CB******60.00****U*Y*AD:D1110~DTP*472*D8*20181128~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.0*S7*19.0*U*Y*AD:D1208~HSD*VS*1***23*1~EB*F*IND**GP**22*1000.00****U*Y*AD:D1208~EB*CB******29.00****U*Y*AD:D1208~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.0*S7*14.0*U*Y*AD:D1351~HSD*VS*1***23*3~EB*F*IND**GP**22*1000.00****U*Y*AD:D1351~EB*CB******28.00****U*Y*AD:D1351~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.0*S7*19.0*U*Y*AD:D1510~HSD*VS*1***23*99~EB*F*IND**GP**22*1000.00****U*Y*AD:D1510~EB*CB******268.00****U*Y*AD:D1510~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.2***U*Y*AD:D2140~HSD*VS*1***34*24~EB*F*IND**GP**22*1000.00****U*Y*AD:D2140~EB*C*IND**GP**22*50.00****U*Y*AD:D2140~EB*CB******77.00****U*Y*AD:D2140~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.2***U*Y*AD:D2391~HSD*VS*1***34*24~EB*F*IND**GP**22*1000.00****U*Y*AD:D2391~EB*C*IND**GP**22*50.00****U*Y*AD:D2391~EB*CB******91.00****U*Y*AD:D2391~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.5***U*Y*AD:D2630~HSD*VS*1***23*5~EB*F*IND**GP**22*1000.00****U*Y*AD:D2630~EB*C*IND**GP**22*50.00****U*Y*AD:D2630~EB*CB******673.00****U*Y*AD:D2630~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.5***U*Y*AD:D2643~HSD*VS*1***23*5~EB*F*IND**GP**22*1000.00****U*Y*AD:D2643~EB*C*IND**GP**22*50.00****U*Y*AD:D2643~EB*CB******797.00****U*Y*AD:D2643~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.5***U*Y*AD:D2750~HSD*VS*1***23*5~EB*F*IND**GP**22*1000.00****U*Y*AD:D2750~EB*C*IND**GP**22*50.00****U*Y*AD:D2750~EB*CB******767.00****U*Y*AD:D2750~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.5***U*Y*AD:D2910~HSD*VS*1***34*12~EB*F*IND**GP**22*1000.00****U*Y*AD:D2910~EB*C*IND**GP**22*50.00****U*Y*AD:D2910~EB*CB******47.00****U*Y*AD:D2910~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.5***U*Y*AD:D2954~HSD*VS*1***23*5~EB*F*IND**GP**22*1000.00****U*Y*AD:D2954~EB*C*IND**GP**22*50.00****U*Y*AD:D2954~EB*CB******177.00****U*Y*AD:D2954~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.5***U*Y*AD:D2980~HSD*VS*1***34*12~EB*F*IND**GP**22*1000.00****U*Y*AD:D2980~EB*C*IND**GP**22*50.00****U*Y*AD:D2980~EB*CB******122.00****U*Y*AD:D2980~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.2***U*Y*AD:D3310~HSD*VS*1***34*24~EB*F*IND**GP**22*1000.00****U*Y*AD:D3310~EB*C*IND**GP**22*50.00****U*Y*AD:D3310~EB*CB******448.00****U*Y*AD:D3310~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.2***U*Y*AD:D4260~HSD*VS*1***34*36~EB*F*IND**GP**22*1000.00****U*Y*AD:D4260~EB*C*IND**GP**22*50.00****U*Y*AD:D4260~EB*CB******793.00****U*Y*AD:D4260~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.2***U*Y*AD:D4341~HSD*VS*1***34*24~DTP*472*D8*20171118~EB*F*IND**GP**22*1000.00****U*Y*AD:D4341~DTP*472*D8*20171118~EB*C*IND**GP**22*50.00****U*Y*AD:D4341~DTP*472*D8*20171118~EB*CB******130.00****U*Y*AD:D4341~DTP*472*D8*20171118~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*I**********U*Y*AD:D4381~EB*A***GP****0.2***U*Y*AD:D4910~HSD*VS*2***23*1~DTP*472*D8*20190611~EB*F*IND**GP**22*1000.00****U*Y*AD:D4910~DTP*472*D8*20190611~EB*C*IND**GP**22*50.00****U*Y*AD:D4910~DTP*472*D8*20190611~EB*CB******80.00****U*Y*AD:D4910~DTP*472*D8*20190611~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.5***U*Y*AD:D5110~HSD*VS*1***23*10~EB*F*IND**GP**22*1000.00****U*Y*AD:D5110~EB*C*IND**GP**22*50.00****U*Y*AD:D5110~EB*CB******925.00****U*Y*AD:D5110~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.5***U*Y*AD:D5670~HSD*VS*1***34*12~EB*F*IND**GP**22*1000.00****U*Y*AD:D5670~EB*C*IND**GP**22*50.00****U*Y*AD:D5670~EB*CB******308.00****U*Y*AD:D5670~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.5***U*Y*AD:D5751~EB*F*IND**GP**22*1000.00****U*Y*AD:D5751~EB*C*IND**GP**22*50.00****U*Y*AD:D5751~EB*CB******294.00****U*Y*AD:D5751~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.5***U*Y*AD:D6010~HSD*VS*1***23*5~EB*F*IND**GP**22*1000.00****U*Y*AD:D6010~EB*C*IND**GP**22*50.00****U*Y*AD:D6010~EB*CB******1474.00****U*Y*AD:D6010~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.5***U*Y*AD:D6013~HSD*VS*1***23*5~EB*F*IND**GP**22*1000.00****U*Y*AD:D6013~EB*C*IND**GP**22*50.00****U*Y*AD:D6013~EB*CB******1459.00****U*Y*AD:D6013~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.5***U*Y*AD:D6210~HSD*VS*1***34*84~EB*F*IND**GP**22*1000.00****U*Y*AD:D6210~EB*C*IND**GP**22*50.00****U*Y*AD:D6210~EB*CB******697.00****U*Y*AD:D6210~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.2***U*Y*AD:D7140~EB*F*IND**GP**22*1000.00****U*Y*AD:D7140~EB*C*IND**GP**22*50.00****U*Y*AD:D7140~EB*CB******79.00****U*Y*AD:D7140~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.2***U*Y*AD:D7240~EB*F*IND**GP**22*1000.00****U*Y*AD:D7240~EB*C*IND**GP**22*50.00****U*Y*AD:D7240~EB*CB******300.00****U*Y*AD:D7240~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*I**********U*Y*AD:D7880~EB*A***GP****0.5*S7*19.0*U*Y*AD:D8070~EB*F*IND**GP**32*1000.00****U*Y*AD:D8070~EB*A***GP****0.2***U*Y*AD:D9110~EB*F*IND**GP**22*1000.00****U*Y*AD:D9110~EB*C*IND**GP**22*50.00****U*Y*AD:D9110~EB*CB******49.00****U*Y*AD:D9110~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*A***GP****0.2***U*Y*AD:D9222~EB*F*IND**GP**22*1000.00****U*Y*AD:D9222~EB*C*IND**GP**22*50.00****U*Y*AD:D9222~EB*CB******126.00****U*Y*AD:D9222~MSG*TBYBQOX WGVJYX = GWWOGJG WPPVDWTPB GWWAPB~EB*I**********U*Y*AD:D9944~EB*I**********U*Y*AD:D9972~SE*432*0001~GE*1*401956009~IEA*1*401956009~";
			long provNum=ProviderT.CreateProvider("prov1","terry","smith",ssn:"123456789",isUsingTIN:true,nationalProvID:"0123456789");
			Prefs.UpdateLong(PrefName.PracticeDefaultProv,provNum);
			Patient pat=PatientT.CreatePatient(suffix,priProvNum:provNum,birthDate:DateTime.Today);
			//Create clearinghouse, set required fields for benefit request validation, and set as default.
			Clearinghouse ch=ClearinghouseT.CreateClearinghouse("ClaimConnect",commBridge:EclaimsCommBridge.ClaimConnect,eFormat:ElectronicClaimFormat.x837D_5010_dental,isa05:"ZZ",
				isa07:"30",isa08:"BCBSGA",isa15:"P");
			Prefs.UpdateLong(PrefName.ClearinghouseDefaultEligibility,ch.ClearinghouseNum);
			Prefs.RefreshCache();
			Clearinghouses.Insert(ch);
			//Create carrier and set required fields for benefit request validation
			Carrier carrier=CarrierT.CreateCarrier(suffix,"123 boring st","boring","OR","97306","1234",arrayTrustedEtrans:TrustedEtransTypes.RealTimeEligibility);
			Carriers.RefreshCache();
			InsPlan insPlan=InsPlanT.CreateInsPlan(carrier.CarrierNum,groupNum:"XYZ123");//Group number should be >3 characters so it passes insverify validation
			InsSub insSub=InsSubT.CreateInsSub(pat.PatNum,insPlan.PlanNum);
			PatPlan patPlan=PatPlanT.CreatePatPlan(1,pat.PatNum,insSub.InsSubNum);
			Operatory op=OperatoryT.CreateOperatory();
			//Create benefits for the plan
			BenefitT.CreateAnnualMax(insPlan.PlanNum,1000);
			BenefitT.CreateDeductibleGeneral(insPlan.PlanNum,BenefitCoverageLevel.Individual,50);
			BenefitT.CreateDeductibleGeneral(insPlan.PlanNum,BenefitCoverageLevel.Family,150);
			AppointmentT.CreateAppointment(pat.PatNum,DateTime.Today,op.OperatoryNum,provNum);
			List<InsVerify> listInsVerifies=InsVerifies.TryBatchPatInsVerify();
			Assert.IsTrue(listInsVerifies[0].BatchVerifyState==BatchInsVerifyState.Success);
			Assert.IsTrue(listInsVerifies[0].DateLastVerified.Date==DateTime.Now.Date);
		}

		[TestMethod]
		public void InsVerifies_MetLifeExample_ShouldPassValidationAndUpdateDateLastVerified() {
			AppointmentT.ClearAppointmentTable();
			CarrierT.ClearCarrierTable();
			string suffix=MethodBase.GetCurrentMethod().Name;
			x270Controller.FakeResponseOverride271=@"ISA*00*          *00*          *30*330989922      *ZZ*810624427      *200114*1331*U*00401*408023317*0*P*:~GS*HB*330989922*330989922*20200114*1331*408023317*X*004010X092A1~ST*271*0001~BHT*8800*44*182800048INA*08088441*4004~HL*4**08*4~NM1*CE*0*UNWIOKN*****CO*77282~HL*0*4*04*4~NM1*4C*4*CEUKNXXOULEI ENLWEI EIIOELPN IIP*****OO*4818721007~HL*0*0*00*8~TRN*0*4*4081012827~NM1*OI*4*PIEEV*XUENNPN*L***UO*228288272~REF*7C*084811*XCUUENEL PEEXN~N3*1040 PUEN CI~N4*PUISUASX*UE*100882700~DMG*E2*42828040*K~DTP*702*E2*08418884~DTP*017*E2*08088484~DTP*018*E2*08084004~EB*F*IND*24***29*1500.00~EB*C*FAM*24**MET*32*0.00~EB*C*FAM*24**MET*22*0.00~EB*C*IND*24**MET*32*0.00~EB*C*IND*24**MET*22*0.00~EB*C*FAM*24***32*0.00~EB*C*FAM*24***22*300.00~EB*C*IND*24***32*0.00~EB*C*IND*24***22*100.00~EB*F*IND*38***33*2500.00~EB*C*FAM*38**MET*32*0.00~EB*C*FAM*38**MET*22*0.00~EB*C*IND*38**MET*32*0.00~EB*C*IND*38**MET*22*0.00~EB*C*FAM*38***32*0.00~EB*C*FAM*38***22*0.00~EB*C*IND*38***32*0.00~EB*C*IND*38***22*0.00~EB*F*IND****33*500.00~MSG*ANLNKOWPIEXX=WUX~EB*F*IND****29*2000.00~MSG*ANLNKOWPIEXX=WUX~EB*C*FAM***MET*32*0.00~MSG*ANLNKOWPIEXX=WUX~EB*C*FAM***MET*22*0.00~MSG*ANLNKOWPIEXX=WUX~EB*C*IND***MET*32*0.00~MSG*ANLNKOWPIEXX=WUX~EB*C*IND***MET*22*0.00~MSG*ANLNKOWPIEXX=WUX~EB*C*FAM****32*0.00~MSG*ANLNKOWPIEXX=WUX~EB*C*FAM****22*300.00~MSG*ANLNKOWPIEXX=WUX~EB*C*IND****32*0.00~MSG*ANLNKOWPIEXX=WUX~EB*C*IND****22*100.00~MSG*ANLNKOWPIEXX=WUX~EB*F*IND****29*1500.00~MSG*ANLNKOWPIEXX=AEXOP~EB*C*FAM***MET*32*0.00~MSG*ANLNKOWPIEXX=AEXOP~EB*C*FAM***MET*22*0.00~MSG*ANLNKOWPIEXX=AEXOP~EB*C*IND***MET*32*0.00~MSG*ANLNKOWPIEXX=AEXOP~EB*C*IND***MET*22*0.00~MSG*ANLNKOWPIEXX=AEXOP~EB*C*FAM****32*0.00~MSG*ANLNKOWPIEXX=AEXOP~EB*C*FAM****22*300.00~MSG*ANLNKOWPIEXX=AEXOP~EB*C*IND****32*0.00~MSG*ANLNKOWPIEXX=AEXOP~EB*C*IND****22*100.00~MSG*ANLNKOWPIEXX=AEXOP~EB*F~MSG*IEOWOLN CNEOUE EUNX LUW ECCIM~EB*F************AD:D1351~MSG*XNPULE UUIEE - CNEUELNLW UUIEEX ULIM, NOPISEOLN IOXEUU WNNWE~EB*F************AD:D1351~MSG*KOEXW UUIEE - CNEUELNLW UUIEEX ULIM, NOPISEOLN IOXEUU WNNWE~EB*F~MSG*CEOUE NOWEEPWOULX EEN PUHNENE~EB*F~MSG*USIWO-HOXOW CEUPNESENX EEN CEOE UL XNEW EEWN~EB*F************AD:D2393~MSG*PUUCUXOWNX EEN LUW EUILNEEENE~EB*F************AD:D2750~MSG*CUEPNIEOL OX LUW EUILNEEENE UL AOPSXCOEX~EB*F************AD:D2750~MSG*CUEPNIEOL OX EUILNEEENE UL UUIEEX~EB*1*ECH*30*GP*JPMORGAN CHASE******N~MSG*KOIOLN IOUOW ENPNUANE, 0804~EB*F*IND*23*GP**22*1500.00****U*N~MSG*WEN OLEOHOESEI ANLNKOW CNEOUE UEOOUSU OX PUUAOLNE IOWE WEN WUX UEOOUSU KUE EL UHNEEII UEOOUSU UK $0888.~EB*A**23*GP****0.1***U*N~EB*F*IND*41*GP**22*1500.00****U*N~EB*A**41*GP****0.1***U*N~EB*F*IND*25*GP**22*1500.00****U*N~EB*C*IND*25*GP**22*100.00****U*N~MSG*OL EEEOWOUL, E $488 OLEOHOESEI ANLNKOW CNEOUE ENESPWOAIN ECCIONX UK IEOPE $8 EEX ANNL SXNE.~EB*A**25*GP****0.3***U*N~EB*F*IND*26*GP**22*1500.00****U*N~EB*C*IND*26*GP**22*100.00****U*N~MSG*OL EEEOWOUL, E $088 KEUOIM ANLNKOW CNEOUE ENESPWOAIN ECCIONX UK IEOPE $8 EEX ANNL SXNE.~EB*A**26*GP****0.5***U*N~EB*F*IND*24*GP**22*1500.00****U*N~EB*C*IND*24*GP**22*100.00****U*N~EB*A**24*GP****0.3***U*N~EB*F*IND*39*GP**22*1500.00****U*N~EB*C*IND*39*GP**22*100.00****U*N~EB*A**39*GP****0.5***U*N~EB*F*IND*40*GP**22*1500.00****U*N~EB*C*IND*40*GP**22*100.00****U*N~EB*A**40*GP****0.3***U*N~EB*F*IND*38*GP**32*2000.00****U*N~EB*A**38*GP****0.5***U*N~EB*A***GP****0.1***U*N*AD:D0150~HSD*VS*2***23*1~DTP*180*E2*08424004~EB*F*IND**GP**22*1500.00****U*N*AD:D0150~DTP*180*E2*08424004~EB*A***GP****0.1***U*N*AD:D0210~HSD*VS*1***34*60~DTP*180*E2*08828802~EB*F*IND**GP**22*1500.00****U*N*AD:D0210~DTP*180*E2*08828802~EB*A***GP****0.1*S7*26.0*U*N*AD:D0270~HSD*VS*2***23*1~DTP*180*E2*08428047~EB*A***GP****0.1*S8*27.0*U*N*AD:D0270~HSD*VS*1***23*1~DTP*180*E2*08428047~EB*F*IND**GP**22*1500.00****U*N*AD:D0270~DTP*180*E2*08428047~EB*I**********U*N*AD:D0431~EB*A***GP****0.1***U*N*AD:D1110~HSD*VS*2***23*1~DTP*180*E2*08424004~EB*F*IND**GP**22*1500.00****U*N*AD:D1110~DTP*180*E2*08424004~EB*A***GP****0.1*S7*19.0*U*N*AD:D1208~HSD*VS*1***23*1~EB*F*IND**GP**22*1500.00****U*N*AD:D1208~EB*A***GP****0.1*S7*19.0*U*N*AD:D1351~HSD*VS*2***23*19~EB*F*IND**GP**22*1500.00****U*N*AD:D1351~EB*A***GP****0.1*S7*14.0*U*N*AD:D1510~EB*F*IND**GP**22*1500.00****U*N*AD:D1510~EB*A***GP****0.3***U*N*AD:D2140~EB*F*IND**GP**22*1500.00****U*N*AD:D2140~EB*C*IND**GP**22*100.00****U*N*AD:D2140~EB*A***GP****0.3***U*N*AD:D2391~EB*F*IND**GP**22*1500.00****U*N*AD:D2391~EB*C*IND**GP**22*100.00****U*N*AD:D2391~EB*A***GP****0.5***U*N*AD:D2630~HSD*VS*1***23*5~EB*F*IND**GP**22*1500.00****U*N*AD:D2630~EB*C*IND**GP**22*100.00****U*N*AD:D2630~EB*A***GP****0.5***U*N*AD:D2643~HSD*VS*1***23*5~EB*F*IND**GP**22*1500.00****U*N*AD:D2643~EB*C*IND**GP**22*100.00****U*N*AD:D2643~EB*A***GP****0.5***U*N*AD:D2750~HSD*VS*1***23*5~EB*F*IND**GP**22*1500.00****U*N*AD:D2750~EB*C*IND**GP**22*100.00****U*N*AD:D2750~EB*A***GP****0.3***U*N*AD:D2910~EB*F*IND**GP**22*1500.00****U*N*AD:D2910~EB*C*IND**GP**22*100.00****U*N*AD:D2910~EB*A***GP****0.5***U*N*AD:D2954~EB*F*IND**GP**22*1500.00****U*N*AD:D2954~EB*C*IND**GP**22*100.00****U*N*AD:D2954~EB*A***GP****0.3***U*N*AD:D2980~EB*F*IND**GP**22*1500.00****U*N*AD:D2980~EB*C*IND**GP**22*100.00****U*N*AD:D2980~EB*A***GP****0.5***U*N*AD:D3310~EB*F*IND**GP**22*1500.00****U*N*AD:D3310~EB*C*IND**GP**22*100.00****U*N*AD:D3310~EB*A***GP****0.3***U*N*AD:D4260~HSD*VS*1***34*36~EB*F*IND**GP**22*1500.00****U*N*AD:D4260~EB*C*IND**GP**22*100.00****U*N*AD:D4260~EB*A***GP****0.3***U*N*AD:D4341~HSD*VS*1***34*24~EB*F*IND**GP**22*1500.00****U*N*AD:D4341~EB*C*IND**GP**22*100.00****U*N*AD:D4341~EB*A***GP****0.3***U*N*AD:D4381~EB*F*IND**GP**22*1500.00****U*N*AD:D4381~EB*C*IND**GP**22*100.00****U*N*AD:D4381~EB*A***GP****0.3***U*N*AD:D4910~HSD*VS*4***23*1~EB*F*IND**GP**22*1500.00****U*N*AD:D4910~EB*C*IND**GP**22*100.00****U*N*AD:D4910~EB*A***GP****0.5***U*N*AD:D5110~HSD*VS*1***23*5~EB*F*IND**GP**22*1500.00****U*N*AD:D5110~EB*C*IND**GP**22*100.00****U*N*AD:D5110~EB*A***GP****0.3***U*N*AD:D5670~EB*F*IND**GP**22*1500.00****U*N*AD:D5670~EB*C*IND**GP**22*100.00****U*N*AD:D5670~EB*A***GP****0.3***U*N*AD:D5751~EB*F*IND**GP**22*1500.00****U*N*AD:D5751~EB*C*IND**GP**22*100.00****U*N*AD:D5751~EB*A***GP****0.5***U*N*AD:D6010~EB*F*IND**GP**22*1500.00****U*N*AD:D6010~EB*C*IND**GP**22*100.00****U*N*AD:D6010~EB*A***GP****0.5***U*N*AD:D6013~EB*F*IND**GP**22*1500.00****U*N*AD:D6013~EB*C*IND**GP**22*100.00****U*N*AD:D6013~EB*A***GP****0.5***U*N*AD:D6210~HSD*VS*1***23*5~EB*F*IND**GP**22*1500.00****U*N*AD:D6210~EB*C*IND**GP**22*100.00****U*N*AD:D6210~EB*A***GP****0.3***U*N*AD:D7140~EB*F*IND**GP**22*1500.00****U*N*AD:D7140~EB*C*IND**GP**22*100.00****U*N*AD:D7140~EB*A***GP****0.3***U*N*AD:D7240~EB*F*IND**GP**22*1500.00****U*N*AD:D7240~EB*C*IND**GP**22*100.00****U*N*AD:D7240~EB*A***GP****0.5***U*N*AD:D7880~EB*F*IND**GP**22*500.00****U*N*AD:D7880~EB*C*IND**GP**22*100.00****U*N*AD:D7880~EB*A***GP****0.5*S7*19.0*U*N*AD:D8070~EB*F*IND**GP**32*2000.00****U*N*AD:D8070~EB*A***GP****0.1***U*N*AD:D9110~EB*F*IND**GP**22*1500.00****U*N*AD:D9110~EB*A***GP****0.3***U*N*AD:D9222~EB*F*IND**GP**22*1500.00****U*N*AD:D9222~EB*C*IND**GP**22*100.00****U*N*AD:D9222~EB*A***GP****0.5***U*N*AD:D9944~EB*F*IND**GP**22*1500.00****U*N*AD:D9944~EB*C*IND**GP**22*100.00****U*N*AD:D9944~EB*I**********U*N*AD:D9972~EB*F*IND*23*GP**22*2000.00****U*Y~MSG*WEN OLEOHOESEI ANLNKOW CNEOUE UEOOUSU OX PUUAOLNE IOWE WEN WUX UEOOUSU KUE EL UHNEEII UEOOUSU UK $0888.~EB*A**23*GP****0.0***U*Y~EB*F*IND*41*GP**22*2000.00****U*Y~EB*A**41*GP****0.0***U*Y~EB*F*IND*25*GP**22*2000.00****U*Y~EB*C*IND*25*GP**22*50.00****U*Y~MSG*OL EEEOWOUL, E $488 OLEOHOESEI ANLNKOW CNEOUE ENESPWOAIN ECCIONX UK IEOPE $8 EEX ANNL SXNE.~EB*A**25*GP****0.2***U*Y~EB*F*IND*26*GP**22*2000.00****U*Y~EB*C*IND*26*GP**22*50.00****U*Y~MSG*OL EEEOWOUL, E $088 KEUOIM ANLNKOW CNEOUE ENESPWOAIN ECCIONX UK IEOPE $8 EEX ANNL SXNE.~EB*A**26*GP****0.4***U*Y~EB*F*IND*24*GP**22*2000.00****U*Y~EB*C*IND*24*GP**22*50.00****U*Y~EB*A**24*GP****0.2***U*Y~EB*F*IND*39*GP**22*2000.00****U*Y~EB*C*IND*39*GP**22*50.00****U*Y~EB*A**39*GP****0.4***U*Y~EB*F*IND*40*GP**22*2000.00****U*Y~EB*C*IND*40*GP**22*50.00****U*Y~EB*A**40*GP****0.2***U*Y~EB*F*IND*38*GP**32*2500.00****U*Y~EB*A**38*GP****0.5***U*Y~EB*A***GP****0.0***U*Y*AD:D0150~HSD*VS*2***23*1~DTP*180*E2*08424004~EB*F*IND**GP**22*2000.00****U*Y*AD:D0150~DTP*180*E2*08424004~EB*CB******38.00****U*Y*AD:D0150~DTP*180*E2*08424004~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.0***U*Y*AD:D0210~HSD*VS*1***34*60~DTP*180*E2*08828802~EB*F*IND**GP**22*2000.00****U*Y*AD:D0210~DTP*180*E2*08828802~EB*CB******74.00****U*Y*AD:D0210~DTP*180*E2*08828802~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.0*S7*26.0*U*Y*AD:D0270~HSD*VS*2***23*1~DTP*180*E2*08428047~EB*A***GP****0.0*S8*27.0*U*Y*AD:D0270~HSD*VS*1***23*1~DTP*180*E2*08428047~EB*F*IND**GP**22*2000.00****U*Y*AD:D0270~DTP*180*E2*08428047~EB*CB******15.00****U*Y*AD:D0270~DTP*180*E2*08428047~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*I**********U*Y*AD:D0431~EB*A***GP****0.0***U*Y*AD:D1110~HSD*VS*2***23*1~DTP*180*E2*08424004~EB*F*IND**GP**22*2000.00****U*Y*AD:D1110~DTP*180*E2*08424004~EB*CB******55.00****U*Y*AD:D1110~DTP*180*E2*08424004~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.0*S7*19.0*U*Y*AD:D1208~HSD*VS*1***23*1~EB*F*IND**GP**22*2000.00****U*Y*AD:D1208~EB*CB******27.00****U*Y*AD:D1208~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.0*S7*19.0*U*Y*AD:D1351~HSD*VS*2***23*19~EB*F*IND**GP**22*2000.00****U*Y*AD:D1351~EB*CB******26.00****U*Y*AD:D1351~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.0*S7*14.0*U*Y*AD:D1510~EB*F*IND**GP**22*2000.00****U*Y*AD:D1510~EB*CB******246.00****U*Y*AD:D1510~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.2***U*Y*AD:D2140~EB*F*IND**GP**22*2000.00****U*Y*AD:D2140~EB*C*IND**GP**22*50.00****U*Y*AD:D2140~EB*CB******70.00****U*Y*AD:D2140~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.2***U*Y*AD:D2391~EB*F*IND**GP**22*2000.00****U*Y*AD:D2391~EB*C*IND**GP**22*50.00****U*Y*AD:D2391~EB*CB******84.00****U*Y*AD:D2391~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.4***U*Y*AD:D2630~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D2630~EB*C*IND**GP**22*50.00****U*Y*AD:D2630~EB*CB******616.00****U*Y*AD:D2630~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.4***U*Y*AD:D2643~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D2643~EB*C*IND**GP**22*50.00****U*Y*AD:D2643~EB*CB******731.00****U*Y*AD:D2643~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.4***U*Y*AD:D2750~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D2750~EB*C*IND**GP**22*50.00****U*Y*AD:D2750~EB*CB******704.00****U*Y*AD:D2750~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.2***U*Y*AD:D2910~EB*F*IND**GP**22*2000.00****U*Y*AD:D2910~EB*C*IND**GP**22*50.00****U*Y*AD:D2910~EB*CB******43.00****U*Y*AD:D2910~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.4***U*Y*AD:D2954~EB*F*IND**GP**22*2000.00****U*Y*AD:D2954~EB*C*IND**GP**22*50.00****U*Y*AD:D2954~EB*CB******163.00****U*Y*AD:D2954~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.2***U*Y*AD:D2980~EB*F*IND**GP**22*2000.00****U*Y*AD:D2980~EB*C*IND**GP**22*50.00****U*Y*AD:D2980~EB*CB******112.00****U*Y*AD:D2980~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.4***U*Y*AD:D3310~EB*F*IND**GP**22*2000.00****U*Y*AD:D3310~EB*C*IND**GP**22*50.00****U*Y*AD:D3310~EB*CB******411.00****U*Y*AD:D3310~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.2***U*Y*AD:D4260~HSD*VS*1***34*36~EB*F*IND**GP**22*2000.00****U*Y*AD:D4260~EB*C*IND**GP**22*50.00****U*Y*AD:D4260~EB*CB******727.00****U*Y*AD:D4260~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.2***U*Y*AD:D4341~HSD*VS*1***34*24~EB*F*IND**GP**22*2000.00****U*Y*AD:D4341~EB*C*IND**GP**22*50.00****U*Y*AD:D4341~EB*CB******119.00****U*Y*AD:D4341~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.2***U*Y*AD:D4381~EB*F*IND**GP**22*2000.00****U*Y*AD:D4381~EB*C*IND**GP**22*50.00****U*Y*AD:D4381~EB*CB******60.00****U*Y*AD:D4381~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.2***U*Y*AD:D4910~HSD*VS*4***23*1~EB*F*IND**GP**22*2000.00****U*Y*AD:D4910~EB*C*IND**GP**22*50.00****U*Y*AD:D4910~EB*CB******73.00****U*Y*AD:D4910~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.4***U*Y*AD:D5110~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D5110~EB*C*IND**GP**22*50.00****U*Y*AD:D5110~EB*CB******849.00****U*Y*AD:D5110~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.2***U*Y*AD:D5670~EB*F*IND**GP**22*2000.00****U*Y*AD:D5670~EB*C*IND**GP**22*50.00****U*Y*AD:D5670~EB*CB******283.00****U*Y*AD:D5670~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.2***U*Y*AD:D5751~EB*F*IND**GP**22*2000.00****U*Y*AD:D5751~EB*C*IND**GP**22*50.00****U*Y*AD:D5751~EB*CB******270.00****U*Y*AD:D5751~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.4***U*Y*AD:D6010~EB*F*IND**GP**22*2000.00****U*Y*AD:D6010~EB*C*IND**GP**22*50.00****U*Y*AD:D6010~EB*CB******1352.00****U*Y*AD:D6010~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.4***U*Y*AD:D6013~EB*F*IND**GP**22*2000.00****U*Y*AD:D6013~EB*C*IND**GP**22*50.00****U*Y*AD:D6013~EB*CB******1339.00****U*Y*AD:D6013~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.4***U*Y*AD:D6210~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D6210~EB*C*IND**GP**22*50.00****U*Y*AD:D6210~EB*CB******640.00****U*Y*AD:D6210~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.2***U*Y*AD:D7140~EB*F*IND**GP**22*2000.00****U*Y*AD:D7140~EB*C*IND**GP**22*50.00****U*Y*AD:D7140~EB*CB******72.00****U*Y*AD:D7140~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.2***U*Y*AD:D7240~EB*F*IND**GP**22*2000.00****U*Y*AD:D7240~EB*C*IND**GP**22*50.00****U*Y*AD:D7240~EB*CB******275.00****U*Y*AD:D7240~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.4***U*Y*AD:D7880~EB*F*IND**GP**22*500.00****U*Y*AD:D7880~EB*C*IND**GP**22*50.00****U*Y*AD:D7880~EB*CB******473.00****U*Y*AD:D7880~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.5*S7*19.0*U*Y*AD:D8070~EB*F*IND**GP**32*2500.00****U*Y*AD:D8070~EB*A***GP****0.0***U*Y*AD:D9110~EB*F*IND**GP**22*2000.00****U*Y*AD:D9110~EB*CB******45.00****U*Y*AD:D9110~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.2***U*Y*AD:D9222~EB*F*IND**GP**22*2000.00****U*Y*AD:D9222~EB*C*IND**GP**22*50.00****U*Y*AD:D9222~EB*CB******116.00****U*Y*AD:D9222~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*A***GP****0.4***U*Y*AD:D9944~EB*F*IND**GP**22*2000.00****U*Y*AD:D9944~EB*C*IND**GP**22*50.00****U*Y*AD:D9944~EB*CB******356.00****U*Y*AD:D9944~MSG*ANLNKOW EUUSLW = UEOOUSU EIIUIEAIN PEEENN~EB*I**********U*Y*AD:D9972~SE*441*0001~GE*1*408023317~IEA*1*408023317~";
			long provNum=ProviderT.CreateProvider("prov1","terry","smith",ssn:"123456789",isUsingTIN:true,nationalProvID:"0123456789");
			Prefs.UpdateLong(PrefName.PracticeDefaultProv,provNum);
			Patient pat=PatientT.CreatePatient(suffix,priProvNum:provNum,birthDate:DateTime.Today);
			//Create clearinghouse, set required fields for benefit request validation, and set as default.
			Clearinghouse ch=ClearinghouseT.CreateClearinghouse("ClaimConnect",commBridge:EclaimsCommBridge.ClaimConnect,eFormat:ElectronicClaimFormat.x837D_5010_dental,isa05:"ZZ",
				isa07:"30",isa08:"BCBSGA",isa15:"P");
			Prefs.UpdateLong(PrefName.ClearinghouseDefaultEligibility,ch.ClearinghouseNum);
			Prefs.RefreshCache();
			Clearinghouses.Insert(ch);
			//Create carrier and set required fields for benefit request validation
			Carrier carrier=CarrierT.CreateCarrier(suffix,"123 boring st","boring","OR","97306","1234",arrayTrustedEtrans:TrustedEtransTypes.RealTimeEligibility);
			Carriers.RefreshCache();
			InsPlan insPlan=InsPlanT.CreateInsPlan(carrier.CarrierNum,groupNum:"XYZ123");//Group number should be >3 characters so it passes insverify validation
			InsSub insSub=InsSubT.CreateInsSub(pat.PatNum,insPlan.PlanNum);
			PatPlan patPlan=PatPlanT.CreatePatPlan(1,pat.PatNum,insSub.InsSubNum);
			Operatory op=OperatoryT.CreateOperatory();
			//Create benefits for the plan
			BenefitT.CreateAnnualMax(insPlan.PlanNum,1500);
			BenefitT.CreateDeductibleGeneral(insPlan.PlanNum,BenefitCoverageLevel.Individual,100);
			BenefitT.CreateDeductibleGeneral(insPlan.PlanNum,BenefitCoverageLevel.Family,300);
			AppointmentT.CreateAppointment(pat.PatNum,DateTime.Today,op.OperatoryNum,provNum);
			List<InsVerify> listInsVerifies=InsVerifies.TryBatchPatInsVerify();
			Assert.IsTrue(listInsVerifies[0].BatchVerifyState==BatchInsVerifyState.Success);
			Assert.IsTrue(listInsVerifies[0].DateLastVerified.Date==DateTime.Now.Date);
			Assert.IsTrue(listInsVerifies[0].VerifyType==VerifyTypes.PatientEnrollment);
		}

		[TestMethod]
		public void InsVerifies_GuardianExample_ShouldCreateInsHistoryProcsFor_Prophy_Exam_Bwx_Pano() {
			AppointmentT.ClearAppointmentTable();
			CarrierT.ClearCarrierTable();
			string suffix=MethodBase.GetCurrentMethod().Name;
			x270Controller.FakeResponseOverride271=@"ISA*00*          *00*          *30*330989922      *ZZ*810624427      *200130*1323*U*00401*412653193*0*P*:~GS*HB*330989922*330989922*20200130*1323*412653193*X*004010X092A1~ST*271*0001~BHT*2211*44*641821431IML*12122412*4111~HL*4**12*4~NM1*GL*1*EEJLLOJA IOYM OAOELJAEM EJ. JY JRML*****GO*86168~HL*1*4*14*4~NM1*4G*1*GLJYMOOOJAJI LMAWJI JIIOJAEM IIE*****YO*146162228~HL*1*1*11*4~NM1*OI*4*LMEBML*OWMGWMA****RO*183224322~REF*8G*22264228~HL*6*1*11*2~TRN*1*4*4146162228~NM1*21*4*LMEBML*JAWJAO****RO*183224322~REF*8G*22264228*TOOOJAJLN OEWJJIO WLEOW~N3*214 IMYYMLOJA LL~N4*LJIIOAE ELMMA*JW*61621~DMG*L2*12412821*R~INS*A*43~DTP*356*D8*20170901~DTP*357*D8*20501231~EB*F~MSG*YOUR BENEFIT PERIOD IS FROM JANUARY 1 TO DECEMBER 31~EB*F~MSG*NON-CONTRACTED COVERAGE IS BASED ON REASONABLE AND CUSTOMARY~EB*1**35**GUARDIAN~EB*A**35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE WAIVED~EB*A**4**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=DIAGNOSTIC X-RAY~MSG*DEDUCTIBLE APPLIES~EB*A**1**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=PA X-RAYS~MSG*DEDUCTIBLE APPLIES~EB*A**30**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=BITEWING X-RAYS~MSG*DEDUCTIBLE APPLIES~EB*A**96**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=FULL MOUTH/PANOREX~MSG*DEDUCTIBLE APPLIES~EB*A**68**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=COMPOSITES~MSG*DEDUCTIBLE APPLIES~EB*A**AQ**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.50****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=IMPLANTS~MSG*DEDUCTIBLE APPLIES~EB*A**A3**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=FLUORIDE~MSG*DEDUCTIBLE WAIVED~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U*AD:D4910~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**BY**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=EXAMS~MSG*DEDUCTIBLE WAIVED~EB*A**9**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=PROPHYLAXIS~MSG*DEDUCTIBLE WAIVED~EB*A**7**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**36**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.50****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**60**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=HARMFUL HABITS APPLIANCE~MSG*DEDUCTIBLE WAIVED~EB*A**40**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE WAIVED~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U*AD:D7111~DTP*348*D8*20170901~MSG*DEDUCTIBLE WAIVED~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U*AD:D7140~DTP*348*D8*20170901~MSG*DEDUCTIBLE WAIVED~EB*A**GY**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.50****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=BUILDUPS/POST AND CORE~MSG*DEDUCTIBLE APPLIES~EB*A**80**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.50****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=INLAY/ONLAY~MSG*DEDUCTIBLE APPLIES~EB*A**39**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.50****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**64**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=AMALGAM & COMPOSITE~MSG*DEDUCTIBLE APPLIES~EB*A**98**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=SEALANTS~MSG*DEDUCTIBLE WAIVED~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U*AD:D1354~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**23**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE WAIVED~EB*A**38**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.50****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE WAIVED~EB*A**38**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*******U~MSG*COVERED ON ELIGIBLE DEPENDENT CHILDREN WHO ARE LESS THAN 19~EB*A**BZ**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***1.00****U~MSG*BENEFITCLASS=TMJ TREATMENT~EB*A**24**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**25**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**26**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**79**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=PERIO SURGERY~MSG*DEDUCTIBLE APPLIES~EB*A**81**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.50****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=DENTURES~MSG*DEDUCTIBLE APPLIES~EB*A**CK**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=DENTURE REPAIR~MSG*DEDUCTIBLE APPLIES~EB*A**CL**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=DENTURE RELINE~MSG*DEDUCTIBLE APPLIES~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.20****U*AD:D9940~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**35**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE WAIVED~EB*A**4**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=DIAGNOSTIC X-RAY~MSG*DEDUCTIBLE APPLIES~EB*A**1**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=PA X-RAYS~MSG*DEDUCTIBLE APPLIES~EB*A**30**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=BITEWING X-RAYS~MSG*DEDUCTIBLE APPLIES~EB*A**96**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=FULL MOUTH/PANOREX~MSG*DEDUCTIBLE APPLIES~EB*A**68**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=COMPOSITES~MSG*DEDUCTIBLE APPLIES~EB*A**AQ**DG PLUS, NON CONTRACTED***0.50****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=IMPLANTS~MSG*DEDUCTIBLE APPLIES~EB*A**A3**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=FLUORIDE~MSG*DEDUCTIBLE WAIVED~EB*A****DG PLUS, NON CONTRACTED***0.20****U*AD:D4910~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**BY**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=EXAMS~MSG*DEDUCTIBLE WAIVED~EB*A**9**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=PROPHYLAXIS~MSG*DEDUCTIBLE WAIVED~EB*A**7**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**36**DG PLUS, NON CONTRACTED***0.50****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**60**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=HARMFUL HABITS APPLIANCE~MSG*DEDUCTIBLE WAIVED~EB*A**40**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE WAIVED~EB*A****DG PLUS, NON CONTRACTED***0.20****U*AD:D7111~DTP*348*D8*20170901~MSG*DEDUCTIBLE WAIVED~EB*A****DG PLUS, NON CONTRACTED***0.20****U*AD:D7140~DTP*348*D8*20170901~MSG*DEDUCTIBLE WAIVED~EB*A**GY**DG PLUS, NON CONTRACTED***0.50****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=BUILDUPS/POST AND CORE~MSG*DEDUCTIBLE APPLIES~EB*A**80**DG PLUS, NON CONTRACTED***0.50****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=INLAY/ONLAY~MSG*DEDUCTIBLE APPLIES~EB*A**39**DG PLUS, NON CONTRACTED***0.50****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**64**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=AMALGAM & COMPOSITE~MSG*DEDUCTIBLE APPLIES~EB*A**98**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=SEALANTS~MSG*DEDUCTIBLE WAIVED~EB*A****DG PLUS, NON CONTRACTED***0.20****U*AD:D1354~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**23**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE WAIVED~EB*A**38**DG PLUS, NON CONTRACTED***0.50****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE WAIVED~EB*A**38**DG PLUS, NON CONTRACTED*******U~MSG*COVERED ON ELIGIBLE DEPENDENT CHILDREN WHO ARE LESS THAN 19~EB*A**BZ**DG PLUS, NON CONTRACTED***1.00****U~MSG*BENEFITCLASS=TMJ TREATMENT~EB*A**24**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**25**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**26**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*A**79**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=PERIO SURGERY~MSG*DEDUCTIBLE APPLIES~EB*A**81**DG PLUS, NON CONTRACTED***0.50****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=DENTURES~MSG*DEDUCTIBLE APPLIES~EB*A**CK**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=DENTURE REPAIR~MSG*DEDUCTIBLE APPLIES~EB*A**CL**DG PLUS, NON CONTRACTED***0.20****U~DTP*348*D8*20170901~MSG*BENEFITCLASS=DENTURE RELINE~MSG*DEDUCTIBLE APPLIES~EB*A****DG PLUS, NON CONTRACTED***0.20****U*AD:D9940~DTP*348*D8*20170901~MSG*DEDUCTIBLE APPLIES~EB*C*IND*35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*22*50.00*****U~EB*C*IND*35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*29*0.00*****U~EB*C*FAM*35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*22*150.00*****U~MSG*3 INDIVIDUAL DEDUCTIBLES MUST BE MET~EB*C*FAM*35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*29*100.00*****U~EB*F*IND*35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*23*2000.00*****U~EB*F*IND*35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*29*1158.94*****U~EB*F*IND*38**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*32*1500.00*****U~EB*C*IND*35**DG PLUS, NON CONTRACTED*22*100.00*****U~EB*C*IND*35**DG PLUS, NON CONTRACTED*29*50.00*****U~EB*C*FAM*35**DG PLUS, NON CONTRACTED*22*300.00*****U~MSG*3 INDIVIDUAL DEDUCTIBLES MUST BE MET~EB*C*FAM*35**DG PLUS, NON CONTRACTED*29*250.00*****U~EB*F*IND*35**DG PLUS, NON CONTRACTED*23*2000.00*****U~EB*F*IND*35**DG PLUS, NON CONTRACTED*29*1158.94*****U~EB*F*IND*38**DG PLUS, NON CONTRACTED*32*1500.00*****U~EB*1**35*GP*GUARDIAN~EB*F~MSG*MULTI-VISIT PROCEDURES ARE PAID ON THE PREPARATION DATE.~EB*F~MSG*WHEN THE EXPECTED COST OF A PROPOSED COURSE OF TREATMENT IS $300 OR MORE, WE RECOMMEND THAT A PREDETERMINATION BE SUBMITTED TO THE CLAIMS ADDRESS.~EB*F**35~MSG*THE LIMITING AGE FOR UNMARRIED DEPENDENTS IS EXTENDED TO AGE 30 IF THE DEPENDENT IS A RESIDENT OF ILLINOIS AND HAS RECEIVED A RELEASE OR DISCHARGE, OTHER THAN DISHONORABLE DISCHARGE, FROM MILITARY SERVICE.~MSG*THERE IS NO STUDENT AGE LIMIT.  UNMARRIED DEP CHILD TO AGE 26 AND UNMARRIED DEP CHILD TO AGE 30 IF  A) IL RESIDENT, AND B) SERVED IN RESERVE OR ACTIVE USA MILITARY, AND C) DISCHARGED OTHER THAN DISHONORABLE.~MSG*DENTAL PROSTHESES NEEDED TO REPLACE TEETH MISSING PRIOR TO BEING INSURED WITH THIS GUARDIAN PLAN ARE NOT COVERED UNLESS THE TOOTH WAS EXTRACTED WHILE COVERED BY THE PRIOR PLAN.~MSG*PLEASE SUBMIT PRE-OPERATIVE, CURRENT AND DIAGNOSTIC RADIOGRAPHIC IMAGES ALONG WITH ANY ADDITIONAL SUPPORTING DOCUMENTATION. FOR FURTHER DETAILS, REFER TO THE DENTAL CLINICAL POLICY IN THE PROVIDER PORTAL ON GUARDIANANYTIME.COM.~MSG*REPAIRS AND MAINTENANCE OF CROWNS, BRIDGES AND DENTURES (D2910-D2920, D2980, D5410-D5422, D5511-D5520, D5611-D5612, D5621-D5761, D5850-D5851, D6092-D6093, D6930, D6980, D9120) ARE COVERED UNDER THE PREVENTIVE SERVICE CATEGORY.~EB*F**4~MSG*BENEFITCLASS=DIAGNOSTIC X-RAY~EB*F**1~MSG*BENEFITCLASS=PA X-RAYS~EB*F**30~HSD*VS*1***34*12~DTP*304*D8*20200109~MSG*BENEFITCLASS=BITEWING X-RAYS~MSG*LIMITED TO EITHER A MAXIMUM OF 4 BITEWING FILMS OR A SET (7-8 FILMS) OF VERTICAL BITEWINGS.~EB*F**96~HSD*VS*1***34*36~DTP*304*D8*20190729~MSG*BENEFITCLASS=FULL MOUTH/PANOREX~EB*F**68~MSG*BENEFITCLASS=COMPOSITES~MSG*COVERED ON ANTERIOR AND POSTERIOR TEETH WITH NUMBER OF SURFACE RESTRICTION REMOVED.~EB*F**AQ~MSG*BENEFITCLASS=IMPLANTS~MSG*COVERED WHEN THERE IS A LIABILITY.~EB*F**A3******S7*18~HSD*VS*2***34*12~DTP*304*D8*20200109~MSG*BENEFITCLASS=FLUORIDE~EB*F************AD:D4910~DTP*304*D8*99990101~EB*F**BY~HSD*VS*2***34*12~DTP*304*D8*20200109~MSG*BENEFITCLASS=EXAMS~EB*F**9~HSD*VS*2***34*12~DTP*304*D8*20200109~MSG*BENEFITCLASS=PROPHYLAXIS~MSG*EITHER ONE REGULAR PROPHYLAXIS OR A PERIODONTAL MAINTENANCE PROCEDURE.~EB*I************AD:D4381~EB*F**7~MSG*ANESTHESIA (D9222, D9223, D9230, D9239, D9243, D9248) IS COVERED WHEN PERFORMED IN CONJUNCTION WITH THREE OR MORE COVERED NON-SURGICAL EXTRACTIONS PERFORMED DURING THE SAME VISIT OR WITH ANY COVERED SURGICAL SERVICE.~EB*F************AD:D9310~HSD*VS*1***34*12~MSG*PER DENTAL SPECIALTY; COVERED WHEN NO OTHER TREATMENT, OTHER THAN RADIOGRAPHIC IMAGES, IS PERFORMED DURING THE SAME VISIT.~EB*F**36~HSD*VS*1***21*10~MSG*SINGLE CROWNS (D2710, D2712, D2720-D2722, D2740, D2750-D2753, D2780-D2783, D2790-D2792, D2794) ARE COVERED UNDER THE MAJOR SERVICE CATEGORY, SUBJECT TO REVIEW.~MSG*PLEASE SUBMIT PRE-OPERATIVE, CURRENT AND DIAGNOSTIC RADIOGRAPHIC IMAGES ALONG WITH ANY ADDITIONAL SUPPORTING DOCUMENTATION.~MSG*INCLUDES VENEERS; WHEN THE APPLIANCE IS NO LONGER USEABLE.~EB*F**60******S7*13~MSG*BENEFITCLASS=HARMFUL HABITS APPLIANCE~MSG*COVERED ONLY WHEN NEEDED TO INHIBIT THUMB SUCKING; INITIAL APPLIANCE ONLY.~EB*F**40~MSG*SURGICAL EXTRACTIONS AND OTHER ORAL SURGERY (D7210-D7261, D7280, D7282-D7288, D7295, D7310-D7350, D7410-D7415, D7440-D7465, D7471-D7473, D7485, D7510-D7521, D7560, D7960-D7990, D7999 ARE COVERED UNDER THE PREVENTIVE SERVICE CATEGORY.~MSG*ORAL SURGICAL SERVICES PERFORMED BY A NON-CONTRACTED DENTIST SHOULD FIRST BE SUBMITTED TO THE COVERED PERSON'S MEDICAL CARRIER.~EB*F************AD:D7111~EB*F************AD:D7140~EB*I************AD:D0431~EB*F************AD:D9944~HSD*VS*1***32*1~MSG*WHEN PERFORMED WITHIN 6 MONTHS AFTER OSSEOUS SURGERY~EB*F************AD:D9945~HSD*VS*1***32*1~MSG*WHEN PERFORMED WITHIN 6 MONTHS AFTER OSSEOUS SURGERY.~EB*F************AD:D4341~HSD*VS*1***34*24~DTP*304*D8*99990101~MSG*WHEN THERE IS RADIOGRAPHIC AND POCKET CHARTING EVIDENCE OF BONE LOSS.~EB*F************AD:D4342~HSD*VS*1***34*24~DTP*304*D8*99990101~MSG*WHEN THERE IS RADIOGRAPHIC AND POCKET CHARTING EVIDENCE OF BONE LOSS.~EB*F**GY~HSD*VS*1***21*10~MSG*BENEFITCLASS=BUILDUPS/POST AND CORE~MSG*APPLIES TO POST AND CORES; WHEN NO LONGER USEABLE.~EB*F**80~HSD*VS*1***21*10~MSG*BENEFITCLASS=INLAY/ONLAY~MSG*WHEN THE APPLIANCE IS NO LONGER USEABLE.~EB*F**39~HSD*VS*1***21*10~MSG*APPLIES TO DENTURES AND BRIDGES; WHEN THE APPLIANCE IS NO LONGE R USEABLE.~EB*F**64******S7*18~HSD*VS*1***34*12~MSG*BENEFITCLASS=AMALGAM & COMPOSITE~EB*F**98******S7*15~HSD*VS*1***34*36~MSG*BENEFITCLASS=SEALANTS~MSG*LIMITED TO UNRESTORED PERMANENT MOLARS.~EB*F************AD:D1354~EB*F**23~MSG*HISTOPATHOLOGIC EXAMS (D0472, D0473, D0474, D0480, D0502) ARE COVERED UNDER THE PREVENTIVE SERVICE CATEGORY.~SE*383*0001~GE*1*412653193~IEA*1*412653193~";
			long provNum=ProviderT.CreateProvider("prov1","terry","smith",ssn:"123456789",isUsingTIN:true,nationalProvID:"0123456789");
			Prefs.UpdateLong(PrefName.PracticeDefaultProv,provNum);
			Patient pat=PatientT.CreatePatient(suffix,priProvNum:provNum,birthDate:DateTime.Today);
			//Create clearinghouse, set required fields for benefit request validation, and set as default.
			Clearinghouse ch=ClearinghouseT.CreateClearinghouse("ClaimConnect",commBridge:EclaimsCommBridge.ClaimConnect,eFormat:ElectronicClaimFormat.x837D_5010_dental,isa05:"ZZ",
				isa07:"30",isa08:"BCBSGA",isa15:"P");
			Prefs.UpdateLong(PrefName.ClearinghouseDefaultEligibility,ch.ClearinghouseNum);
			Prefs.RefreshCache();
			//Create procedures for insurance history assert below
			ProcedureT.CreateProcedure(pat,"D0272",ProcStat.EO,"",0);
			ProcedureT.CreateProcedure(pat,"D0210",ProcStat.EO,"",0);
			ProcedureT.CreateProcedure(pat,"D0120",ProcStat.EO,"",0);
			ProcedureT.CreateProcedure(pat,"D1110",ProcStat.EO,"",0);
			Clearinghouses.Insert(ch);
			//Create carrier and set required fields for benefit request validation
			Carrier carrier=CarrierT.CreateCarrier(suffix,"123 boring st","boring","OR","97306","1234",arrayTrustedEtrans:TrustedEtransTypes.RealTimeEligibility);
			Carriers.RefreshCache();
			InsPlan insPlan=InsPlanT.CreateInsPlan(carrier.CarrierNum,groupNum:"XYZ123");//Group number should be >3 characters so it passes insverify validation
			InsSub insSub=InsSubT.CreateInsSub(pat.PatNum,insPlan.PlanNum);
			PatPlan patPlan=PatPlanT.CreatePatPlan(1,pat.PatNum,insSub.InsSubNum);
			Operatory op=OperatoryT.CreateOperatory();
			//Create benefits for the plan
			BenefitT.CreateAnnualMax(insPlan.PlanNum,2000);
			BenefitT.CreateDeductibleGeneral(insPlan.PlanNum,BenefitCoverageLevel.Individual,100);
			BenefitT.CreateDeductibleGeneral(insPlan.PlanNum,BenefitCoverageLevel.Family,300);
			AppointmentT.CreateAppointment(pat.PatNum,DateTime.Today,op.OperatoryNum,provNum);
			List<InsVerify> listInsVerifies=InsVerifies.TryBatchPatInsVerify();
			Assert.IsTrue(listInsVerifies[0].BatchVerifyState==BatchInsVerifyState.Success);
			Assert.IsTrue(listInsVerifies[0].DateLastVerified.Date==DateTime.Now.Date);
			Assert.IsTrue(listInsVerifies[0].VerifyType==VerifyTypes.PatientEnrollment);
			//Check that a procedure was created for InsHistBWCodes,InsHistPanoCodes,InsHistExamCodes,InsHistProphyCodes with the correct date from the 271
			List<ClaimProc> listHistCPs=new List<ClaimProc>();
			Dictionary<PrefName,Procedure> dictHistProcs=Procedures.GetDictInsHistProcs(pat.PatNum,insSub.InsSubNum,out listHistCPs);
			Procedure bw=dictHistProcs[PrefName.InsHistBWCodes];
			Procedure pano=dictHistProcs[PrefName.InsHistPanoCodes];
			Procedure exam=dictHistProcs[PrefName.InsHistExamCodes];
			Procedure prophy=dictHistProcs[PrefName.InsHistProphyCodes];
			Assert.IsTrue(bw!=null && bw.ProcDate==new DateTime(2020,1,9));
			Assert.IsTrue(pano!=null && pano.ProcDate==new DateTime(2019,1,29));
			Assert.IsTrue(exam!=null && exam.ProcDate==new DateTime(2020,1,9));
			Assert.IsTrue(prophy!=null && prophy.ProcDate==new DateTime(2020,1,9));
		}
	}
}
